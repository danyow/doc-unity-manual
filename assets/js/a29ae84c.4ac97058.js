"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[83417],{3905:function(e,r,t){t.d(r,{Zo:function(){return h},kt:function(){return d}});var n=t(67294);function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function o(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=n.createContext({}),u=function(e){var r=n.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):s(s({},r),e)),t},h=function(e){var r=u(e.components);return n.createElement(c.Provider,{value:r},e.children)},l={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},p=n.forwardRef((function(e,r){var t=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),p=u(t),d=a,m=p["".concat(c,".").concat(d)]||p[d]||l[d]||i;return t?n.createElement(m,s(s({ref:r},h),{},{components:t})):n.createElement(m,s({ref:r},h))}));function d(e,r){var t=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=p;var o={};for(var c in r)hasOwnProperty.call(r,c)&&(o[c]=r[c]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var u=2;u<i;u++)s[u]=t[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},75868:function(e,r,t){t.r(r),t.d(r,{assets:function(){return h},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return l}});var n=t(87462),a=t(63366),i=(t(67294),t(3905)),s=["components"],o={id:"batch-renderer-group-registering-meshes-and-materials",title:"Registering meshes and materials",slug:"/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials"},c="Registering meshes and materials",u={unversionedId:"graphics/graphics-performance-profiling/batch-renderer-group/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials",id:"graphics/graphics-performance-profiling/batch-renderer-group/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials",title:"Registering meshes and materials",description:"Mesh and Material are managed C# objects in Unity which means you can\u2019t use them from Burst C# code. This means that to use them in BRG draw commands, you must pre-register with the BRG.",source:"@site/docs/graphics/graphics-performance-profiling/batch-renderer-group/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials.md",sourceDirName:"graphics/graphics-performance-profiling/batch-renderer-group/batch-renderer-group-creating-a-renderer",slug:"/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials",permalink:"/doc-unity-manual/docs/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/graphics/graphics-performance-profiling/batch-renderer-group/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials.md",tags:[],version:"current",frontMatter:{id:"batch-renderer-group-registering-meshes-and-materials",title:"Registering meshes and materials",slug:"/batch-renderer-group-creating-a-renderer/batch-renderer-group-registering-meshes-and-materials"},sidebar:"tutorialSidebar",previous:{title:"Initializing a BatchRendererGroup object",permalink:"/doc-unity-manual/docs/batch-renderer-group-creating-a-renderer/batch-renderer-group-initializing"},next:{title:"Getting started with BatchRendererGroup",permalink:"/doc-unity-manual/docs/batch-renderer-group/batch-renderer-group-getting-started"}},h={},l=[],p={toc:l};function d(e){var r=e.components,t=(0,a.Z)(e,s);return(0,i.kt)("wrapper",(0,n.Z)({},p,t,{components:r,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"registering-meshes-and-materials"},"Registering meshes and materials"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Mesh.html"},"Mesh")," and ",(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Material.html"},"Material")," are managed C# objects in Unity which means you can\u2019t use them from ",(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/Packages/com.unity.burst@latest"},"Burst")," C# code. This means that to use them in BRG draw commands, you must pre-register with the BRG."),(0,i.kt)("p",null,"To register Mesh and Material objects, use ",(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchRendererGroup.RegisterMesh.html"},"BatchRendererGroup.RegisterMesh")," and ",(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchRendererGroup.RegisterMaterial.html"},"BatchRendererGroup.RegisterMaterial")," respectively. These functions return a ",(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchMeshID.html"},"BatchMeshID")," and a ",(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchMaterialID.html"},"BatchMaterialID"),", respectively, which are plain data structs that contain a Burst-compatible handle. They are strongly typed to help prevent errors from accidentally using the wrong handle type."),(0,i.kt)("p",null,"You can register Mesh and Material objects at any time, including run time. The only requirements are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You need to register Mesh and Material objects before the BatchRendererGroup can use them to render."),(0,i.kt)("li",{parentName:"ul"},"The Material must support DOTS Instancing.")),(0,i.kt)("p",null,"You can also unregister Mesh and Material objects if you no longer need them. This is necessary if you want to unload any Mesh or Material objects. ",(0,i.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchRendererGroup.Dispose.html"},"BatchRendererGroup.Dispose")," automatically unregisters all registered assets."),(0,i.kt)("p",null," ",(0,i.kt)("strong",{parentName:"p"},"Note")," : You can\u2019t serialize a BatchMeshID or a BatchMaterialID. They are only valid with the BatchRendererGroup you register them with and become invalid if you unregister them, or if the BatchRendererGroup no longer exists. BatchMeshID and BatchMaterialID also become invalid if something forces Unity to unload the Mesh or Material objects, which can happen when switching the scene."),(0,i.kt)("p",null,"It is possible to register the same Mesh or Material object multiple times. This is useful in situations where you want to register things without having to know what else has been registered already. In this situation, the BatchRenderer keeps an internal count of the number of registrations:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Each time you register a Mesh or Material object, the BatchRendererGroup increases its reference count by 1.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Each time you unregister a Mesh or Material object, the BatchRendererGroup decreases its reference count by 1. If this causes the reference count to reach 0, the BatchRendererGroup unregisters the Mesh or Material. If you want to use the Mesh or Material in future draw commands, you must register it again.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"A RegisterMesh or RegisterMaterial call with an already registered Mesh or Material returns the same BatchMeshID or BatchMaterialID as the previous call. However, if the BatchRendererGroup completely unregistered the Mesh or Material, registering it again could return a different ID."),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Note")," : BRG checks for modifications to Mesh or Material objects after the first OnPerformCulling callback method in a frame. This means that Unity takes any modification that occurs before that point into account. This includes changes you make in the first callback itself, but not changes that occur in any jobs scheduled by the callback. Modifying Mesh or Material objects after that point causes undefined behavior."))),(0,i.kt)("p",null,"See the following code sample for an example of how to register meshes and materials with a BatchRendererGroup object. This code sample builds on the one in ",(0,i.kt)("a",{parentName:"p",href:"/doc-unity-manual/docs/batch-renderer-group-creating-a-renderer/batch-renderer-group-initializing"},"Initializing a BatchRendererGroup object"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"using System;\nusing Unity.Collections;\nusing Unity.Collections.LowLevel.Unsafe;\nusing Unity.Jobs;\nusing UnityEngine;\nusing UnityEngine.Rendering;\n\npublic class SimpleBRGExample : MonoBehaviour\n{\n    public Mesh mesh;\n    public Material material;\n\n    private BatchRendererGroup m_BRG;\n\n    private BatchMeshID m_MeshID;\n    private BatchMaterialID m_MaterialID;\n\n    private void Start()\n    {\n        m_BRG = new BatchRendererGroup(this.OnPerformCulling, IntPtr.Zero);\n        m_MeshID = m_BRG.RegisterMesh(mesh);\n        m_MaterialID = m_BRG.RegisterMaterial(material);\n    }\n\n    private void OnDisable()\n    {\n        m_BRG.Dispose();\n    }\n\n    public unsafe JobHandle OnPerformCulling(\n        BatchRendererGroup rendererGroup,\n        BatchCullingContext cullingContext,\n        BatchCullingOutput cullingOutput,\n        IntPtr userContext)\n    {\n        // This simple example doesn't use jobs, so it can just return an empty JobHandle.\n        // Performance sensitive applications should use Burst jobs to implement\n        // culling and draw command output. In this case, this function would return a\n        // handle here that completes when those jobs have finished.\n        return new JobHandle();\n    }\n}\n")),(0,i.kt)("p",null,"Before you create any draw commands that use the meshes and materials, you need to provide data for each instance to use. To do this, BatchRendererGroup uses a concept called batches. For more information, see the next topic, ",(0,i.kt)("a",{parentName:"p",href:"/doc-unity-manual/docs/batch-renderer-group-creating-a-renderer/batch-renderer-group-creating-batches"},"Creating batches"),"."))}d.isMDXComponent=!0}}]);