"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[68944],{3905:function(t,e,n){n.d(e,{Zo:function(){return c},kt:function(){return h}});var i=n(67294);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e){if(null==t)return{};var n,i,a=function(t,e){if(null==t)return{};var n,i,a={},r=Object.keys(t);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var l=i.createContext({}),d=function(t){var e=i.useContext(l),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},c=function(t){var e=d(t.components);return i.createElement(l.Provider,{value:e},t.children)},s={inlineCode:"code",wrapper:function(t){var e=t.children;return i.createElement(i.Fragment,{},e)}},u=i.forwardRef((function(t,e){var n=t.components,a=t.mdxType,r=t.originalType,l=t.parentName,c=p(t,["components","mdxType","originalType","parentName"]),u=d(n),h=a,g=u["".concat(l,".").concat(h)]||u[h]||s[h]||r;return n?i.createElement(g,o(o({ref:e},c),{},{components:n})):i.createElement(g,o({ref:e},c))}));function h(t,e){var n=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var r=n.length,o=new Array(r);o[0]=u;var p={};for(var l in e)hasOwnProperty.call(e,l)&&(p[l]=e[l]);p.originalType=t,p.mdxType="string"==typeof t?t:a,o[1]=p;for(var d=2;d<r;d++)o[d]=n[d];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},89290:function(t,e,n){n.r(e),n.d(e,{assets:function(){return c},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return p},metadata:function(){return d},toc:function(){return s}});var i=n(87462),a=n(63366),r=(n(67294),n(3905)),o=["components"],p={id:"android-AppPatching",title:"Application patching",slug:"/android-testing-and-debugging/android-app-patching"},l="Application patching",d={unversionedId:"platform-specific/android/android-developing/android-testing-and-debugging/android-AppPatching",id:"platform-specific/android/android-developing/android-testing-and-debugging/android-AppPatching",title:"Application patching",description:"Building an application for Android can take a significant amount of time. For faster iterations during development, you can patch the application package instead of rebuilding it. When you patch an application package, Unity only processes files you made changes to since the last patch and sends them to the connected Android device.",source:"@site/docs/platform-specific/android/android-developing/android-testing-and-debugging/android-app-patching.md",sourceDirName:"platform-specific/android/android-developing/android-testing-and-debugging",slug:"/android-testing-and-debugging/android-app-patching",permalink:"/docs/android-testing-and-debugging/android-app-patching",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/platform-specific/android/android-developing/android-testing-and-debugging/android-app-patching.md",tags:[],version:"current",frontMatter:{id:"android-AppPatching",title:"Application patching",slug:"/android-testing-and-debugging/android-app-patching"},sidebar:"tutorialSidebar",previous:{title:"Testing and debugging",permalink:"/docs/android-testing-and-debugging"},next:{title:"Debugging on an Android device",permalink:"/docs/android-testing-and-debugging/android-debugging-on-an-android-device"}},c={},s=[{value:"Platform compatibility",id:"platform-compatibility",level:2},{value:"Patching an application",id:"patching-an-application",level:2},{value:"From the Editor",id:"from-the-editor",level:3},{value:"Using the scripting API",id:"using-the-scripting-api",level:3},{value:"How application patching works",id:"how-application-patching-works",level:2},{value:"\u6e05\u9664\u8865\u4e01\u6587\u4ef6",id:"\u6e05\u9664\u8865\u4e01\u6587\u4ef6",level:2}],u={toc:s};function h(t){var e=t.components,n=(0,a.Z)(t,o);return(0,r.kt)("wrapper",(0,i.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"application-patching"},"Application patching"),(0,r.kt)("p",null,"Building an application for Android can take a significant amount of time. For faster iterations during development, you can patch the application package instead of rebuilding it. When you patch an application package, Unity only processes files you made changes to since the last patch and sends them to the connected Android device."),(0,r.kt)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"\u5e73\u53f0")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Application patching")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Android")),(0,r.kt)("td",{parentName:"tr",align:null},"\u53d7\u652f\u6301")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Chrome OS")),(0,r.kt)("td",{parentName:"tr",align:null},"Unsupported")))),(0,r.kt)("h2",{id:"patching-an-application"},"Patching an application"),(0,r.kt)("p",null,"To patch an application, you can use the Unity Editor or, if you implement your own build pipeline, the scripting API."),(0,r.kt)("p",null,"The first time you patch an application, Unity sets up the patch application environment on the device. This means that the first patch takes longer than future patches."),(0,r.kt)("h3",{id:"from-the-editor"},"From the Editor"),(0,r.kt)("p",null,"To patch an application from the Unity Editor:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open the Build Settings window (menu:  ",(0,r.kt)("strong",{parentName:"li"},"File"),"  ",">","  ",(0,r.kt)("strong",{parentName:"li"},"Build Settings")," )."),(0,r.kt)("li",{parentName:"ol"},"Select the  ",(0,r.kt)("strong",{parentName:"li"},"Android"),"  platform from the  ",(0,r.kt)("strong",{parentName:"li"},"Platform"),"  list."),(0,r.kt)("li",{parentName:"ol"},"Enable  ",(0,r.kt)("strong",{parentName:"li"},"Development Build")," ."),(0,r.kt)("li",{parentName:"ol"},"Select  ",(0,r.kt)("strong",{parentName:"li"},"Patch"),"  or, if you want to run the patch after Unity finishes building it,  ",(0,r.kt)("strong",{parentName:"li"},"Patch And Run")," .")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/android-app-patching.png",alt:"The Android Build Settings window."})),(0,r.kt)("p",null,"The Android Build Settings window."),(0,r.kt)("h3",{id:"using-the-scripting-api"},"Using the scripting API"),(0,r.kt)("p",null,"If you implement your own build pipeline, you can use the scripting API to patch your application. To do this, pass the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/BuildOptions.BuildScriptsOnly.html"},"BuildOptions.BuildScriptsOnly")," and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/BuildOptions.PatchPackage.html"},"BuildOptions.PatchPackage")," options to the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/BuildPipeline.BuildPlayer.html"},"BuildPipeline.BuildPlayer")," method."),(0,r.kt)("p",null,"\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'BuildPlayerOptions buildPlayerOptions = new BuildPlayerOptions();\nbuildPlayerOptions.scenes = new[] { "Assets/Scene1.unity"};\nbuildPlayerOptions.target = BuildTarget.Android;\n// Use Patch & Run for all builds for optimal turn-around times.\n// (In prior versions, an initial regular Build & Run was necessary.)\nbuildPlayerOptions.options = BuildOptions.PatchPackage | BuildOptions.AutoRunPlayer | BuildOptions.Development;\nBuildPipeline.BuildPlayer(buildPlayerOptions);\n')),(0,r.kt)("h2",{id:"how-application-patching-works"},"How application patching works"),(0,r.kt)("p",null,"When you patch an application, Unity:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Creates a minimal APK that contains all compiled Java sources."),(0,r.kt)("li",{parentName:"ul"},"Takes files that have changed since the last patch and stores them in a directory inside the application\u2019s cache folder at: ",(0,r.kt)("inlineCode",{parentName:"li"},"/storage/emulated/0/Android/data/&lt;PackageName&gt;/pram-shadow-files/"),"."),(0,r.kt)("li",{parentName:"ul"},"Stores native library files, including scripts compiled using ",(0,r.kt)("a",{parentName:"li",href:"/docs/il2cpp"},"Il2cpp"),", in the application\u2019s data directory at: ",(0,r.kt)("inlineCode",{parentName:"li"},"/data/data/&lt;PackageName&gt;/pram-shadow-files/lib/"),".")),(0,r.kt)("p",null,"When the application starts, it checks for a marker file inside the APK. If the marker exists, the application redirects its file reads to the ",(0,r.kt)("inlineCode",{parentName:"p"},"pram-shadow-files")," directory."),(0,r.kt)("p",null,"A  ",(0,r.kt)("strong",{parentName:"p"},"Build & Run"),"  doesn\u2019t clear any of the patch files. Instead, it replaces the APK install. This disables the redirect to the ",(0,r.kt)("inlineCode",{parentName:"p"},"pram-shadow-files")," directory. This means that subsequent patch builds can re-use unchanged files."),(0,r.kt)("h2",{id:"\u6e05\u9664\u8865\u4e01\u6587\u4ef6"},"\u6e05\u9664\u8865\u4e01\u6587\u4ef6"),(0,r.kt)("p",null,"You can use the Android storage settings to clear the application\u2019s cache. Clearing the cache removes the patch files installed by the application patching build process."),(0,r.kt)("p",null,"The steps to clear an application\u2019s cache are different depending on the Android device. To find the steps for your device:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Go to ",(0,r.kt)("a",{parentName:"li",href:"https://support.google.com/android/answer/3094742"},"Get help from your device manufacturer"),"."),(0,r.kt)("li",{parentName:"ol"},"Find your device manufacturer and follow the link to its support site."),(0,r.kt)("li",{parentName:"ol"},"Search the support site for steps on clearing an application\u2019s cache.")))}h.isMDXComponent=!0}}]);