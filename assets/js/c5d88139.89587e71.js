"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[92452],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(n),h=i,u=m["".concat(l,".").concat(h)]||m[h]||d[h]||r;return n?a.createElement(u,o(o({ref:t},c),{},{components:n})):a.createElement(u,o({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},90186:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return d}});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=["components"],s={id:"performance-profiler-traces",title:"Analyzing profiler traces",slug:"/performance-profiling-tools/performance-profiler-traces"},l="Analyzing profiler traces",p={unversionedId:"unity-overview/analysis/performance-profiling-tools/performance-profiler-traces",id:"unity-overview/analysis/performance-profiling-tools/performance-profiler-traces",title:"Analyzing profiler traces",description:"When you profile your application, there are some common issues that you might come across. This page outlines how to investigate the cause of some common performance issues.",source:"@site/docs/unity-overview/analysis/performance-profiling-tools/performance-profiler-traces.md",sourceDirName:"unity-overview/analysis/performance-profiling-tools",slug:"/performance-profiling-tools/performance-profiler-traces",permalink:"/docs/performance-profiling-tools/performance-profiler-traces",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/unity-overview/analysis/performance-profiling-tools/performance-profiler-traces.md",tags:[],version:"current",frontMatter:{id:"performance-profiler-traces",title:"Analyzing profiler traces",slug:"/performance-profiling-tools/performance-profiler-traces"},sidebar:"tutorialSidebar",previous:{title:"Profiling tools",permalink:"/docs/performance-profiling-tools"},next:{title:"\u6027\u80fd\u5206\u6790\u5668\u6982\u8ff0",permalink:"/docs/profiler"}},c={},d=[{value:"\u89e3\u6790\u542f\u52a8\u8ddf\u8e2a",id:"\u89e3\u6790\u542f\u52a8\u8ddf\u8e2a",level:2},{value:"\u89e3\u6790\u8fd0\u884c\u65f6\u8ddf\u8e2a",id:"\u89e3\u6790\u8fd0\u884c\u65f6\u8ddf\u8e2a",level:2},{value:"\u89e3\u6790\u811a\u672c\u65b9\u6cd5",id:"\u89e3\u6790\u811a\u672c\u65b9\u6cd5",level:2},{value:"\u8d44\u6e90\u52a0\u8f7d",id:"\u8d44\u6e90\u52a0\u8f7d",level:2}],m={toc:d};function h(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"analyzing-profiler-traces"},"Analyzing profiler traces"),(0,r.kt)("p",null,"When you profile your application, there are some common issues that you might come across. This page outlines how to investigate the cause of some common performance issues."),(0,r.kt)("h2",{id:"\u89e3\u6790\u542f\u52a8\u8ddf\u8e2a"},"\u89e3\u6790\u542f\u52a8\u8ddf\u8e2a"),(0,r.kt)("p",null,"When looking at a trace of start-up times, there are two key methods to inspect: ",(0,r.kt)("inlineCode",{parentName:"p"},"UnityInitApplicationGraphics")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"UnityLoadApplication"),". These two methods are the primary places where the configuration, assets, and code of a project can impact start-up time."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"Note:"),"  The start-up time of your application differs from platform to platform. On most platforms, start up happens while the ",(0,r.kt)("a",{parentName:"p",href:"/docs/class-player-settings/class-player-settings-splash-screen"},"splash screen")," appears."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/UnderstandingPerformanceinUnity-ProfilingSection_image_0.png",alt:"Instruments trace of an example Unity project running on an iOS device"})),(0,r.kt)("p",null,"Instruments trace of an example Unity project running on an iOS device"),(0,r.kt)("p",null,"In the above screenshot from an Instruments trace of an example Unity project running on an iOS device, in the platform-specific ",(0,r.kt)("inlineCode",{parentName:"p"},"startUnity")," method, note the ",(0,r.kt)("inlineCode",{parentName:"p"},"UnityInitApplicationGraphics")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"UnityLoadApplication")," methods."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"UnityInitApplicationGraphics")," performs a lot of internal work, such as setting up the graphics device and initializing a lot of Unity\u2019s internal systems. It also initializes the ",(0,r.kt)("a",{parentName:"p",href:"/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity6"},"Resources system")," by loading an index of all the files contained in the Resources system."),(0,r.kt)("p",null,"Unity\u2019s ",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/Resources.html"},"Resource system")," includes every ",(0,r.kt)("a",{parentName:"p",href:"/docs/asset-types"},"asset file")," in its data that\u2019s in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Resources")," folder in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Assets")," folder of your project. This includes any files in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Resources")," folder\u2019s children folders. As such, the time required to initialize the Resources system increases in correlation with the number of files within the ",(0,r.kt)("inlineCode",{parentName:"p"},"Resources")," folders in your application\u2019s project."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"UnityLoadApplication")," contains methods that load and initialize the first Scene in the project. This includes deserializing and instantiating the data necessary to display the first Scene, such as compiling Shaders, uploading Textures and instantiating GameObjects. Also, Unity executes the ",(0,r.kt)("inlineCode",{parentName:"p"},"Awake")," callbacks of all ",(0,r.kt)("inlineCode",{parentName:"p"},"MonoBehaviour"),"s in the first Scene."),(0,r.kt)("p",null,"\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u5982\u679c\u5728\u9879\u76ee\u7684\u7b2c\u4e00\u4e2a\u573a\u666f\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Awake")," \u56de\u8c03\u4e2d\u5b58\u5728\u4efb\u4f55\u6267\u884c\u65f6\u95f4\u5f88\u957f\u7684\u4ee3\u7801\uff0c\u90a3\u4e48\u8be5\u4ee3\u7801\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9879\u76ee\u7684\u521d\u59cb\u542f\u52a8\u65f6\u95f4\u7684\u5ef6\u957f\u3002\u89e3\u51b3\u6b64\u95ee\u9898\u7684\u65b9\u6cd5\u662f\u5220\u9664\u8fd9\u4e9b\u8fd0\u884c\u901f\u5ea6\u6162\u7684\u4ee3\u7801\uff0c\u6216\u8005\u5728\u5e94\u7528\u7a0b\u5e8f\u751f\u547d\u5468\u671f\u7684\u5176\u4ed6\u5730\u65b9\u6267\u884c\u8be5\u4ee3\u7801\u3002"),(0,r.kt)("h2",{id:"\u89e3\u6790\u8fd0\u884c\u65f6\u8ddf\u8e2a"},"\u89e3\u6790\u8fd0\u884c\u65f6\u8ddf\u8e2a"),(0,r.kt)("p",null,"For profiling traces captured after the initial startup time, the primary place of interest is the method ",(0,r.kt)("inlineCode",{parentName:"p"},"PlayerLoop"),". This is Unity\u2019s main loop, and the code within it runs once per frame."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/UnderstandingPerformanceinUnity-ProfilingSection_image_1.png",alt:"Instruments trace of an example Unity project"})),(0,r.kt)("p",null,"Instruments trace of an example Unity project"),(0,r.kt)("p",null,"The above screenshot illustrates several of the most performance-impacting methods within ",(0,r.kt)("inlineCode",{parentName:"p"},"PlayerLoop"),".  ",(0,r.kt)("strong",{parentName:"p"},"Note:"),"  The names of methods within the ",(0,r.kt)("inlineCode",{parentName:"p"},"PlayerLoop")," might vary between Unity versions."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"PlayerRender")," is the method that runs Unity\u2019s rendering system. This includes culling objects, calculating dynamic batches, and submitting drawing instructions to the GPU. Any Image Effects or rendering-based script callbacks (",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/MonoBehaviour.OnWillRenderObject.html"},"OnWillRenderObject"),", for example) also run here. In general, this should be the top consumer of CPU time while the project is interactive."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"BaseBehaviourManager")," calls three templated versions of ",(0,r.kt)("inlineCode",{parentName:"p"},"CommonUpdate"),". These invoke certain callbacks within the ",(0,r.kt)("inlineCode",{parentName:"p"},"MonoBehaviour"),"s attached to active GameObjects in the current Scene:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CommonUpdate&lt;UpdateManager&gt;")," \u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"Update")," \u56de\u8c03"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CommonUpdate&lt;LateUpdateManager&gt;")," \u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"LateUpdate")," \u56de\u8c03"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CommonUpdate&lt;FixedUpdateManager&gt;")," \u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"FixedUpdate"),"\uff08\u5982\u679c\u7269\u7406\u7cfb\u7edf\u5df2\u52fe\u9009\uff09")),(0,r.kt)("p",null,"In general, ",(0,r.kt)("inlineCode",{parentName:"p"},"BaseBehaviourManager::CommonUpdate&lt;UpdateManager&gt;")," is the most useful method family to inspect, because it\u2019s the entry point for most of the script code running within a Unity project."),(0,r.kt)("p",null,"There are several other methods that are useful to inspect:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"UI::CanvasManager")," invokes several different callbacks if a project uses the ",(0,r.kt)("a",{parentName:"li",href:"https://docs.unity3d.com/Packages/com.unity.ugui@latest"},"UGUI system"),". This includes Unity UI\u2019s batch computation and layout updates; the two operations that most often cause ",(0,r.kt)("inlineCode",{parentName:"li"},"CanvasManager")," to appear in the Profiler."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"DelayedCallManager::Update")," runs ",(0,r.kt)("a",{parentName:"li",href:"/docs/scripting-concepts/coroutines"},"coroutines"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PhysicsManager::FixedUpdate")," runs the PhysX physics system. This primarily involves running PhysX\u2019s internal code. The number of physics objects in the current Scene, such as ",(0,r.kt)("inlineCode",{parentName:"li"},"Rigidbody")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"Collider")," influence PhysX\u2019s internal code. Physics-based callbacks also appear here: in particular, ",(0,r.kt)("inlineCode",{parentName:"li"},"OnTriggerStay")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"OnCollisionStay"),".")),(0,r.kt)("p",null,"If the project is using 2D physics, that appears as a similar set of calls under ",(0,r.kt)("inlineCode",{parentName:"p"},"Physics2DManager::FixedUpdate"),"."),(0,r.kt)("h2",{id:"\u89e3\u6790\u811a\u672c\u65b9\u6cd5"},"\u89e3\u6790\u811a\u672c\u65b9\u6cd5"),(0,r.kt)("p",null,"When scripts are invoked on platforms cross-compiled with IL2CPP, look for trace lines that contain a ",(0,r.kt)("inlineCode",{parentName:"p"},"ScriptingInvocation")," object. This is the point where Unity\u2019s internal native code transitions into the script runtime to execute script code.  ",(0,r.kt)("strong",{parentName:"p"},"Note:"),"  Technically, after Unity runs your C# code through IL2CPP, it also becomes native code. However, this cross-compiled code primarily executes methods via the IL2CPP runtime framework and doesn\u2019t resemble handwritten C++."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/UnderstandingPerformanceinUnity-ProfilingSection_image_2.png",alt:"A trace from an example Unity project"})),(0,r.kt)("p",null,"A trace from an example Unity project"),(0,r.kt)("p",null,"In the above screenshot, the methods nested beneath the ",(0,r.kt)("inlineCode",{parentName:"p"},"RuntimeInvoker_Void")," line are part of cross-compiled C# scripts that Unity executed once per frame."),(0,r.kt)("p",null,"The trace lines\u2019 names are the name of the original class followed by an underscore and the name of the original method. In this example trace, you can see ",(0,r.kt)("inlineCode",{parentName:"p"},"EventSystem.Update"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PlayerShooting.Update")," and several other ",(0,r.kt)("inlineCode",{parentName:"p"},"Update")," methods. These are the standard Unity ",(0,r.kt)("inlineCode",{parentName:"p"},"Update")," callbacks found in most ",(0,r.kt)("inlineCode",{parentName:"p"},"MonoBehaviours"),"."),(0,r.kt)("p",null,"You can expand these methods to see which methods within them consumed CPU time. This includes other script methods within the project, Unity APIs, and C# library code."),(0,r.kt)("p",null,"The above trace shows that the ",(0,r.kt)("inlineCode",{parentName:"p"},"StandaloneInputModule.Process")," method was ray casting through the entire UI once per frame. This method detects whether any touch events were hovering over, or activating any UI elements. The method iterating over all the UI elements, and testing whether the mouse\u2019s position is within their bounding rectangle is resource-intensive."),(0,r.kt)("h2",{id:"\u8d44\u6e90\u52a0\u8f7d"},"\u8d44\u6e90\u52a0\u8f7d"),(0,r.kt)("p",null,"You can also identify asset loading in CPU traces. The main method that indicates an Asset load is ",(0,r.kt)("inlineCode",{parentName:"p"},"SerializedFile::ReadObject"),". This method connects a binary data stream from a file to Unity\u2019s serialization system, which operates via a method named ",(0,r.kt)("inlineCode",{parentName:"p"},"Transfer"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"Transfer")," method is on all Asset types, such as Textures, MonoBehaviours and Particle Systems."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/UnderstandingPerformanceinUnity-ProfilingSection_image_3.png",alt:"Trace of a Scene loading"})),(0,r.kt)("p",null,"Trace of a Scene loading"),(0,r.kt)("p",null,"The above screenshot is a trace of Unity loading a Scene. When it loads a Scene, Unity reads and deserializes all the Assets within the Scene, as denoted by the calls to various ",(0,r.kt)("inlineCode",{parentName:"p"},"Transfer")," methods beneath ",(0,r.kt)("inlineCode",{parentName:"p"},"SerializedFile::ReadObject"),"."),(0,r.kt)("p",null,"If you see a performance stutter during runtime and the performance trace shows that ",(0,r.kt)("inlineCode",{parentName:"p"},"SerializedFile::ReadObject")," used a significant amount of time, it means that Asset loads reduced the frame rate.  ",(0,r.kt)("strong",{parentName:"p"},"Note:"),"  ",(0,r.kt)("inlineCode",{parentName:"p"},"SerializedFile::ReadObject")," usually appears on the main thread when the ",(0,r.kt)("inlineCode",{parentName:"p"},"SceneManager"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Resources")," or AssetBundle APIs request synchronous Asset loads."),(0,r.kt)("p",null,"To resolve this performance stutter can you can make Asset loading asynchronous (which moves the heavy ",(0,r.kt)("inlineCode",{parentName:"p"},"ReadObject")," call to a worker thread), or preload certain heavy Assets."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Transfer")," calls also appear when Unity clones objects (denoted by the ",(0,r.kt)("inlineCode",{parentName:"p"},"CloneObject")," method in a trace). If a call to ",(0,r.kt)("inlineCode",{parentName:"p"},"Transfer")," appears beneath a ",(0,r.kt)("inlineCode",{parentName:"p"},"CloneObject")," call, then Unity isn\u2019t loading the Asset from storage. Instead, Unity transfers the old object\u2019s data to the new object. To do this, Unity serializes the old object and deserializes the resulting data as the new object."))}h.isMDXComponent=!0}}]);