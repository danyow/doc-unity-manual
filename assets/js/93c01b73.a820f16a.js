"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[29],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return n?i.createElement(h,o(o({ref:t},c),{},{components:n})):i.createElement(h,o({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},58508:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return u}});var i=n(87462),a=n(63366),r=(n(67294),n(3905)),o=["components"],l={id:"IL2CPP",title:"IL2CPP Overview",slug:"/il2cpp"},s="IL2CPP Overview",p={unversionedId:"scripting-section/unity-architecture/scripting-backends/il2cpp/IL2CPP",id:"scripting-section/unity-architecture/scripting-backends/il2cpp/IL2CPP",title:"IL2CPP Overview",description:"The  IL2CPP  (Intermediate Language To C++) scripting backend is an alternative to the Mono backend. IL2CPP provides better support for applications across a wider range of platforms. The IL2CPP backend converts MSIL (Microsoft Intermediate Language) code (for example, C# code in scripts) into C++ code, then uses the C++ code to create a native binary file (for example, .exe, .apk, or .xap) for your chosen platform.",source:"@site/docs/scripting-section/unity-architecture/scripting-backends/il2cpp/il2cpp.md",sourceDirName:"scripting-section/unity-architecture/scripting-backends/il2cpp",slug:"/il2cpp",permalink:"/doc-unity-manual/docs/il2cpp",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/scripting-section/unity-architecture/scripting-backends/il2cpp/il2cpp.md",tags:[],version:"current",frontMatter:{id:"IL2CPP",title:"IL2CPP Overview",slug:"/il2cpp"},sidebar:"tutorialSidebar",previous:{title:"\u811a\u672c\u540e\u7aef",permalink:"/doc-unity-manual/docs/scripting-backends"},next:{title:"Handling platform specific settings for IL2CPP additional arguments",permalink:"/doc-unity-manual/docs/il2cpp/handling-il2cpp-additional-args"}},c={},u=[{value:"Building a project using IL2CPP",id:"building-a-project-using-il2cpp",level:2},{value:"How IL2CPP works",id:"how-il2cpp-works",level:2},{value:"Optimizing IL2CPP build times",id:"optimizing-il2cpp-build-times",level:2},{value:"Enabling runtime checks using Il2CppSetOption",id:"enabling-runtime-checks-using-il2cppsetoption",level:2}],d={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,o);return(0,r.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"il2cpp-overview"},"IL2CPP Overview"),(0,r.kt)("p",null,"The  ",(0,r.kt)("strong",{parentName:"p"},"IL2CPP"),"  (Intermediate Language To C++) scripting backend is an alternative to the Mono backend. IL2CPP provides better support for applications across a wider range of platforms. The IL2CPP backend converts MSIL (Microsoft Intermediate Language) code (for example, C# code in scripts) into C++ code, then uses the C++ code to create a native binary file (for example, .exe, .apk, or .xap) for your chosen platform."),(0,r.kt)("p",null,"This type of compilation, in which Unity compiles code specifically for a target platform when it builds the native binary, is called ahead-of-time (AOT) compilation. The ",(0,r.kt)("a",{parentName:"p",href:"/doc-unity-manual/docs/scripting-backends/mono"},"Mono backend")," compiles code at runtime, with a technique called just-in-time compilation (JIT)."),(0,r.kt)("p",null,"On this page:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#building-a-project-using-il2cpp"},"Building a project using IL2CPP")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#how-il2cpp-works"},"How IL2CPP works")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#optimising-il2cpp-build-times"},"Optimising IL2CPP build times")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#enabling-runtime-checks-using-il2cpp-set-option"},"Enabling runtime checks using IL2CppSetOption"))),(0,r.kt)("p",null,"Some platforms don\u2019t support AOT compilation, so the IL2CPP backend doesn\u2019t work on every platform. Other platforms support AOT and IL2CPP, but don\u2019t allow JIT compilation, and so can\u2019t support the Mono backend. When a platform can support both backends, Mono is the default. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"/doc-unity-manual/docs/scripting-backends/scripting-restrictions"},"Scripting restrictions"),"."),(0,r.kt)("p",null,"IL2CPP can improve performance across a variety of platforms, but the need to include machine code in built applications increases both the build time and the size of the final built application. For more information, see How IL2CPP works and the blog series ",(0,r.kt)("a",{parentName:"p",href:"https://blog.unity.com/technology/an-introduction-to-ilcpp-internals"},"An introduction to IL2CPP internals.")),(0,r.kt)("p",null,"IL2CPP supports the debugging of managed code in the same way as the Mono scripting backend. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"/doc-unity-manual/docs/scripting-setting-up/managed-code-debugging"},"Debugging C# code in Unity"),"."),(0,r.kt)("h2",{id:"building-a-project-using-il2cpp"},"Building a project using IL2CPP"),(0,r.kt)("p",null,"To build a project with IL2CPP, you need to have the backend installed in your Unity installation. You can select IL2CPP as an optional module when you first install a version of Unity, or add IL2CPP support to an existing installation through the Unity Hub. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/hub/manual/index.html"},"Installing the Unity Hub")," and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/hub/manual/AddModules.html"},"Add modules to the Unity Editor"),"."),(0,r.kt)("p",null,"You can change the scripting backend Unity uses to build your application in one of two ways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Through the  ",(0,r.kt)("strong",{parentName:"p"},"Player Settings"),"  menu in the Editor. Perform the following steps to change the scripting backend through the  ",(0,r.kt)("strong",{parentName:"p"},"Player Settings"),"  menu:"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Go to  ",(0,r.kt)("strong",{parentName:"li"},"Edit"),"  ",">","  ",(0,r.kt)("strong",{parentName:"li"},"Project Settings")," ."),(0,r.kt)("li",{parentName:"ol"},"Click on the  ",(0,r.kt)("strong",{parentName:"li"},"Player Settings"),"  button to open the ",(0,r.kt)("a",{parentName:"li",href:"/doc-unity-manual/docs/class-player-settings"}," ",(0,r.kt)("strong",{parentName:"a"},"Player")," ")," settings for the current platform in the ",(0,r.kt)("a",{parentName:"li",href:"/doc-unity-manual/docs/using-the-inspector"}," ",(0,r.kt)("strong",{parentName:"a"},"Inspector")," "),"."),(0,r.kt)("li",{parentName:"ol"},"Navigate to the  ",(0,r.kt)("strong",{parentName:"li"},"Configuration"),"  section heading under the  ",(0,r.kt)("strong",{parentName:"li"},"Other Settings"),"  sub-menu."),(0,r.kt)("li",{parentName:"ol"},"Click on the  ",(0,r.kt)("strong",{parentName:"li"},"Scripting Backend"),"  dropdown menu, then select  ",(0,r.kt)("strong",{parentName:"li"},"IL2CPP")," .")),(0,r.kt)("p",{parentName:"li"},"You can also open the  ",(0,r.kt)("strong",{parentName:"p"},"Player Settings"),"  menu from inside the  ",(0,r.kt)("strong",{parentName:"p"},"Build Settings"),"  menu; go to  ",(0,r.kt)("strong",{parentName:"p"},"File"),"  ",">","  ",(0,r.kt)("strong",{parentName:"p"},"Build Settings"),"  and click on the  ",(0,r.kt)("strong",{parentName:"p"},"Player Settings"),"  button.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Through the Editor scripting API. Use the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/PlayerSettings.SetScriptingBackend.html"},"PlayerSettings.SetScriptingBackend")," property to change the scripting backend that Unity uses."))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/IL2CPP-build-settings.png",alt:"The Configuration section of the Player settings"})),(0,r.kt)("p",null,"The  ",(0,r.kt)("strong",{parentName:"p"},"Configuration"),"  section of the  ",(0,r.kt)("strong",{parentName:"p"},"Player"),"  settings"),(0,r.kt)("p",null,"To start the build process, open the  ",(0,r.kt)("strong",{parentName:"p"},"Build Settings"),"  window and click the  ",(0,r.kt)("strong",{parentName:"p"},"Build"),"  button. Unity then converts your C# code and assemblies into C++ and finally produces a binary file for your target platform."),(0,r.kt)("h2",{id:"how-il2cpp-works"},"How IL2CPP works"),(0,r.kt)("p",null,"When you start a build using IL2CPP, Unity automatically performs the following steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The Roslyn C# compiler compiles your application\u2019s C# code and any required package code to .NET DLLs (managed assemblies)."),(0,r.kt)("li",{parentName:"ol"},"Unity applies managed ",(0,r.kt)("a",{parentName:"li",href:"/doc-unity-manual/docs/scripting-backends/managed-code-stripping"},"bytecode stripping"),". This step can significantly reduce the size of a built application."),(0,r.kt)("li",{parentName:"ol"},"The IL2CPP backend converts all managed assemblies into standard C++ code."),(0,r.kt)("li",{parentName:"ol"},"The C++ compiler compiles the generated C++ code and the runtime part of IL2CPP with a native platform compiler."),(0,r.kt)("li",{parentName:"ol"},"Unity creates either an executable file or a DLL, depending on the platform you target.")),(0,r.kt)("p",null,"Both IL2CPP and Mono provide a few useful options which you can control with attributes in your scripts. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"/doc-unity-manual/docs/platform-dependent-compilation"},"Platform-dependent compilation.")),(0,r.kt)("p",null,"IL2CPP enables Unity to pre-compile code for specific platforms. The binary file Unity produces at the end of this process already contains necessary machine code for the target platform, while Mono has to compile this machine code at runtime during execution. AOT compilation does increase build time, but it also improves compatibility with the target platform and can improve performance."),(0,r.kt)("p",null,"Both scripting backends require a new build for each platform you want to target. For example, to support both the Android and iOS platforms, you need to build your application twice and produce two binary files."),(0,r.kt)("p",null,"The assembly stripping stage helps reduce the final binary size. Unity removes any bytecode that the final built application doesn\u2019t use."),(0,r.kt)("h2",{id:"optimizing-il2cpp-build-times"},"Optimizing IL2CPP build times"),(0,r.kt)("p",null,"Project build times when using IL2CPP can be significantly longer than when using Mono. However, you can do several things to reduce build time."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"Exclude your project from anti-malware software scans")," "),(0,r.kt)("p",null,"You can exclude your Unity project folder and target build folders from anti-malware software scans before you build your project."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"Store your project and target build folder on a solid-state drive (SSD)")," "),(0,r.kt)("p",null,"Solid-state drives (SSDs) have faster read/write speeds than traditional hard disk drives (HDD). Converting IL code to C++ and compiling it involves a large number of read/write operations, so a faster storage device speeds up this process."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"Change the IL2CPP Code Generation option in the Build Settings")," "),(0,r.kt)("p",null,"To change how IL2CPP generates code, open the Build Settings and configure the IL2CPP Code Generation option By default, the Faster runtime option is enabled, which produces more machine code that reduces the impact of IL2CPP at runtime. To reduce build times, you can set this option to Faster (smaller) builds. This method produces and includes less machine code in the binary executable and so can reduce performance at runtime, but also significantly reduces build times and binary size."),(0,r.kt)("h2",{id:"enabling-runtime-checks-using-il2cppsetoption"},"Enabling runtime checks using Il2CppSetOption"),(0,r.kt)("p",null,"When you use the IL2CPP scripting backend, you can control how  ",(0,r.kt)("strong",{parentName:"p"},"il2cpp.exe"),"  generates C++ code. You can use the  ",(0,r.kt)("strong",{parentName:"p"},"Il2CppSetOption"),"  attribute to enable or disable the following runtime checks:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"\u5c5e\u6027\uff1a")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"\u63cf\u8ff0\uff1a")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"Default:")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Null checks")),(0,r.kt)("td",{parentName:"tr",align:null},"If this option is enabled, the C++ code that IL2CPP generates contains null checks and throws managed NullReferenceException exceptions as necessary. If this option is disabled, IL2CPP doesn\u2019t emit the null checks into the generated C++ code. For some projects, disabling this option might improve runtime performance.",(0,r.kt)("br",null),(0,r.kt)("br",null),"When this setting is disabled, Unity doesn\u2019t prevent attempts to access null values in the generated code, which might lead to incorrect behavior. Your application is likely to crash soon after it dereferences the null value. Unity recommends that you don\u2019t disable this option."),(0,r.kt)("td",{parentName:"tr",align:null},"Enabled")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Array bounds checks")),(0,r.kt)("td",{parentName:"tr",align:null},"If this option is enabled, the C++ code that IL2CPP generates contains array bounds checks and throws managed IndexOutOfRangeException exceptions as necessary. If this option is disabled, IL2CPP doesn\u2019t emit the array bounds checks into the generated C++ code. ",(0,r.kt)("br",null),(0,r.kt)("br",null),"For some projects, disabling this option might improve runtime performance. However, when this option is disabled, Unity doesn\u2019t prevent attempts to access an array with invalid indices in the generated code, which might lead to incorrect behavior, including reading from or writing to arbitrary memory locations. In most cases, these memory accesses occur without any immediate side effects, and can corrupt the state of the application with no obvious warning signs. This can make debugging these errors extremely difficult. Unity recommends that you keep this option enabled."),(0,r.kt)("td",{parentName:"tr",align:null},"Enabled")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Divide by zero checks")),(0,r.kt)("td",{parentName:"tr",align:null},"If this option is enabled, C++ code generated by IL2CPP contains divide by zero checks for integer division and throw managed DivideByZeroException exceptions as necessary. If this option is disabled, IL2CPP doesn\u2019t emit the divide by zero checks on integer division into the generated C++ code. ",(0,r.kt)("br",null),(0,r.kt)("br",null),"These checks have an impact on performance at runtime. You should only enable this option if you need to run divide by zero checks; otherwise, leave it disabled."),(0,r.kt)("td",{parentName:"tr",align:null},"Disabled")))),(0,r.kt)("p",null,"To use the  ",(0,r.kt)("strong",{parentName:"p"},"Il2CppSetOption"),"  attribute:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"In the directory where your Unity version is installed, navigate to the  ",(0,r.kt)("strong",{parentName:"li"},"Data","\\","il2cpp"),"  directory on Windows, or the  ",(0,r.kt)("strong",{parentName:"li"},"Contents/Frameworks/il2cpp"),"  directory on OS X."),(0,r.kt)("li",{parentName:"ol"},"Find the  ",(0,r.kt)("strong",{parentName:"li"},"Il2CppSetOptionAttribute.cs"),"  source file."),(0,r.kt)("li",{parentName:"ol"},"Copy the source file into your project\u2019s  ",(0,r.kt)("strong",{parentName:"li"},"Assets"),"  directory.")),(0,r.kt)("p",null,"The below example describes how to use the  ",(0,r.kt)("strong",{parentName:"p"},"Il2CppSetOption"),"  attribute:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[Il2CppSetOption(Option.NullChecks, false)]\npublic static string MethodWithNullChecksDisabled()\n{\n    var tmp = new object();\n    return tmp.ToString();\n}\n")),(0,r.kt)("p",null,"You can apply  ",(0,r.kt)("strong",{parentName:"p"},"Il2CppSetOption"),"  attribute to types, methods, and properties. Unity uses the attribute from the most local scope."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[Il2CppSetOption(Option.NullChecks, false)]\npublic class TypeWithNullChecksDisabled\n{\n    public static string AnyMethod()\n    {\n        // Unity doesn\u2019t perform null checks in this method.\n        var tmp = new object();\n        return tmp.ToString();\n    }\n\n    [Il2CppSetOption(Option.NullChecks, true)]\n    public static string MethodWithNullChecksEnabled()\n    {\n        // Unity performs null checks in this method.\n        var tmp = new object();\n        return tmp.ToString();\n    }\n}\n\npublic class SomeType\n{\n    [Il2CppSetOption(Option.NullChecks, false)]\n    public string PropertyWithNullChecksDisabled\n    {\n        get\n        {\n            // Unity doesn\u2019t perform null checks here.\n            var tmp = new object();\n            return tmp.ToString();\n        }\n        set\n        {\n            // Unity doesn\u2019t perform null checks here.\n            value.ToString();\n        }\n    }\n\n    public string PropertyWithNullChecksDisabledOnGetterOnly\n    {\n        [Il2CppSetOption(Option.NullChecks, false)]\n        get\n        {\n            // Unity doesn\u2019t perform null checks here.\n            var tmp = new object();\n            return tmp.ToString();\n        }\n        set\n        {\n            // Unity performs null checks here.\n            value.ToString();\n        }\n    }\n}\n")),(0,r.kt)("hr",null),(0,r.kt)("p",null,"\u2022 2018\u201305\u201315\u9875\u9762\u5df2\u4fee\u8ba2",(0,r.kt)("br",null)))}m.isMDXComponent=!0}}]);