"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[59270],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),d=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return i.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),m=d(n),u=a,h=m["".concat(s,".").concat(u)]||m[u]||c[u]||o;return n?i.createElement(h,l(l({ref:t},p),{},{components:n})):i.createElement(h,l({ref:t},p))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:a,l[1]=r;for(var d=2;d<o;d++)l[d]=n[d];return i.createElement.apply(null,l)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},59743:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return r},metadata:function(){return d},toc:function(){return c}});var i=n(87462),a=n(63366),o=(n(67294),n(3905)),l=["components"],r={id:"UIE-HowTo-CreateEditorWindow",title:"Create a custom Editor window",slug:"/uie-examples/uie-how-to-create-editor-window"},s="Create a custom Editor window",d={unversionedId:"uitoolkits/uielements/uie-examples/UIE-HowTo-CreateEditorWindow",id:"uitoolkits/uielements/uie-examples/UIE-HowTo-CreateEditorWindow",title:"Create a custom Editor window",description:"Custom Editor windows allow you to extend Unity by implementing your own editors and workflows. This guide covers creating an Editor window through code, reacting to user input, making the UI resizable and handling hot-reloading.",source:"@site/docs/uitoolkits/uielements/uie-examples/uie-how-to-create-editor-window.md",sourceDirName:"uitoolkits/uielements/uie-examples",slug:"/uie-examples/uie-how-to-create-editor-window",permalink:"/docs/uie-examples/uie-how-to-create-editor-window",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/uitoolkits/uielements/uie-examples/uie-how-to-create-editor-window.md",tags:[],version:"current",frontMatter:{id:"UIE-HowTo-CreateEditorWindow",title:"Create a custom Editor window",slug:"/uie-examples/uie-how-to-create-editor-window"},sidebar:"tutorialSidebar",previous:{title:"Create a tabbed menu for runtime",permalink:"/docs/uie-examples/uie-create-tabbed-menu-for-runtime"},next:{title:"Get started with UI Toolkit",permalink:"/docs/uie-getting-started"}},p={},c=[{value:"\u5148\u51b3\u6761\u4ef6",id:"\u5148\u51b3\u6761\u4ef6",level:2},{value:"Content",id:"content",level:2},{value:"Create the Editor window script",id:"create-the-editor-window-script",level:2},{value:"\u521b\u5efa\u4e00\u4e2a\u83dc\u5355\u9879\u6765\u6253\u5f00\u7a97\u53e3",id:"\u521b\u5efa\u4e00\u4e2a\u83dc\u5355\u9879\u6765\u6253\u5f00\u7a97\u53e3",level:2},{value:"\u5411\u7a97\u53e3\u6dfb\u52a0 UI \u63a7\u4ef6",id:"\u5411\u7a97\u53e3\u6dfb\u52a0-ui-\u63a7\u4ef6",level:2},{value:"Add callbacks",id:"add-callbacks",level:2},{value:"\u4f7f UI \u53ef\u8c03\u6574\u5927\u5c0f",id:"\u4f7f-ui-\u53ef\u8c03\u6574\u5927\u5c0f",level:2},{value:"\u652f\u6301\u5728\u7f16\u8f91\u5668\u4e2d\u70ed\u91cd\u8f7d",id:"\u652f\u6301\u5728\u7f16\u8f91\u5668\u4e2d\u70ed\u91cd\u8f7d",level:2},{value:"Editor window script",id:"editor-window-script",level:2}],m={toc:c};function u(e){var t=e.components,n=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,i.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"create-a-custom-editor-window"},"Create a custom Editor window"),(0,o.kt)("p",null,"Custom Editor windows allow you to extend Unity by implementing your own editors and workflows. This guide covers creating an Editor window through code, reacting to user input, making the UI resizable and handling hot-reloading."),(0,o.kt)("p",null,"In this tutorial, you will create a sprite browser, which finds and displays all sprites inside the project, and shows them as a list. Selecting a sprite in the list will display the image on the right side of the window."),(0,o.kt)("p",null,"You can find the completed example in the ",(0,o.kt)("a",{parentName:"p",href:"#editor-window-script"},"Editor window script")," section."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/uie-howto-customeditor-window-final.png",alt:"\u81ea\u5b9a\u4e49\u7cbe\u7075\u6d4f\u89c8\u5668"})),(0,o.kt)("p",null,"\u81ea\u5b9a\u4e49\u7cbe\u7075\u6d4f\u89c8\u5668"),(0,o.kt)("h2",{id:"\u5148\u51b3\u6761\u4ef6"},"\u5148\u51b3\u6761\u4ef6"),(0,o.kt)("p",null,"This guide is for developers familiar with Unity, but new to UI Toolkit. It\u2019s recommended to have a basic understanding of Unity and C# scripting."),(0,o.kt)("p",null,"This guide also references the following concepts:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/uielements/uie-visual-tree"},"Visual Tree")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/uie-controls"},"Controls"))),(0,o.kt)("h2",{id:"content"},"Content"),(0,o.kt)("p",null," ",(0,o.kt)("strong",{parentName:"p"},"Controls used in this guide:")," "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.ListView.html"},"ListView")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.TwoPaneSplitView.html"},"TwoPaneSplitView")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.Label.html"},"Label")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.Image.html"},"Image"))),(0,o.kt)("p",null,"In this guide, you\u2019ll do the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create the Editor window script."),(0,o.kt)("li",{parentName:"ul"},"Create a menu entry to open the window."),(0,o.kt)("li",{parentName:"ul"},"Add UI controls to the window."),(0,o.kt)("li",{parentName:"ul"},"Write code to respond to user selections."),(0,o.kt)("li",{parentName:"ul"},"Make the UI resizable."),(0,o.kt)("li",{parentName:"ul"},"Support hot-reloading in the Editor.")),(0,o.kt)("h2",{id:"create-the-editor-window-script"},"Create the Editor window script"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Tip"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"You can generate the necessary code to create an Editor window script in the Unity Editor. From the Project window, right-click and select  ",(0,o.kt)("strong",{parentName:"td"},"Create"),"  ",">","  ",(0,o.kt)("strong",{parentName:"td"},"UI Toolkit"),"  ",">","  ",(0,o.kt)("strong",{parentName:"td"},"Editor Window")," . For this guide please disable the UXML and USS checkboxes. You might also have to add additional ",(0,o.kt)("inlineCode",{parentName:"td"},"using")," directives at the top of the file, as shown below.")))),(0,o.kt)("p",null,"You can create Editor windows through C# scripts in your project. A custom Editor window is a class that derives from the ",(0,o.kt)("inlineCode",{parentName:"p"},"EditorWindow")," class."),(0,o.kt)("p",null,"Create a new script file ",(0,o.kt)("inlineCode",{parentName:"p"},"MyCustomEditor.cs")," under the  ",(0,o.kt)("strong",{parentName:"p"},"Assets/Editor"),"  folder. Paste the following code into the script:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"using System.Collections.Generic;\nusing System.Linq;\nusing UnityEditor;\nusing UnityEngine;\nusing UnityEngine.UIElements;\n\npublic class MyCustomEditor : EditorWindow\n{\n}\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"\u6ce8\u610f"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"This is an Editor-only window that includes the ",(0,o.kt)("inlineCode",{parentName:"td"},"UnityEditor")," namespace, so the file must be placed under the ",(0,o.kt)("inlineCode",{parentName:"td"},"Editor")," ",(0,o.kt)("a",{parentName:"td",href:"https://docs.unity3d.com/Manual/SpecialFolders.html"},"folder"),", or inside an Editor-only Assembly Definition.")))),(0,o.kt)("h2",{id:"\u521b\u5efa\u4e00\u4e2a\u83dc\u5355\u9879\u6765\u6253\u5f00\u7a97\u53e3"},"\u521b\u5efa\u4e00\u4e2a\u83dc\u5355\u9879\u6765\u6253\u5f00\u7a97\u53e3"),(0,o.kt)("p",null,"To open the new Editor window, you must create an entry in the Editor menu."),(0,o.kt)("p",null,"Add the ",(0,o.kt)("inlineCode",{parentName:"p"},"MenuItem")," attribute to a static method. In this example, the name of the static method is ",(0,o.kt)("inlineCode",{parentName:"p"},"ShowMyEditor()"),"."),(0,o.kt)("p",null,"Inside ",(0,o.kt)("inlineCode",{parentName:"p"},"ShowMyEditor()"),", call the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/EditorWindow.GetWindow.html"},"EditorWindow.GetWindow()")," method to create and display the window. It returns an ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/EditorWindow.html"},"EditorWindow")," object. To set the window title, change the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/EditorWindow.titleContent.html"},"EditorWindow.titleContent")," property."),(0,o.kt)("p",null,"Add the following function inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"MyCustomEditor")," class created in the previous step."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[MenuItem("Tools/My Custom Editor")]\npublic static void ShowMyEditor()\n{\n  // \u5f53\u7528\u6237\u5728\u7f16\u8f91\u5668\u4e2d\u9009\u62e9\u83dc\u5355\u9879\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\n  EditorWindow wnd = GetWindow&lt;MyCustomEditor&gt;();\n  wnd.titleContent = new GUIContent("My Custom Editor");\n}\n')),(0,o.kt)("p",null,"Test your new window by opening it via the Unity Editor menu  ",(0,o.kt)("strong",{parentName:"p"},"Tools"),"  ",">","  ",(0,o.kt)("strong",{parentName:"p"},"My Custom Editor")," ."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/uie-howto-customeditor-window-title.png",alt:"\u5177\u6709\u81ea\u5b9a\u4e49\u6807\u9898\u7684\u7f16\u8f91\u5668\u7a97\u53e3"})),(0,o.kt)("p",null,"\u5177\u6709\u81ea\u5b9a\u4e49\u6807\u9898\u7684\u7f16\u8f91\u5668\u7a97\u53e3"),(0,o.kt)("h2",{id:"\u5411\u7a97\u53e3\u6dfb\u52a0-ui-\u63a7\u4ef6"},"\u5411\u7a97\u53e3\u6dfb\u52a0 UI \u63a7\u4ef6"),(0,o.kt)("p",null,"UI Toolkit uses the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/EditorWindow.CreateGUI.html"},"CreateGUI")," method to add controls to Editor UI, and Unity calls the ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI")," method automatically when the window needs to display. This method works the same way as methods such as ",(0,o.kt)("inlineCode",{parentName:"p"},"Awake")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"Update"),"."),(0,o.kt)("p",null,"You can add UI controls to the UI by adding visual elements to the visual tree. The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.VisualElement.Add.html"},"VisualElement.Add()")," method is used to add children to an existing visual element. The ",(0,o.kt)("a",{parentName:"p",href:"/docs/uielements/uie-visual-tree"},"visual tree")," of an Editor window is accessed via the ",(0,o.kt)("inlineCode",{parentName:"p"},"rootvisualElement")," property."),(0,o.kt)("p",null,"To get started, add a ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," function to your custom Editor class and add a \u2018Hello\u2019 label:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'public void CreateGUI()\n{\n  rootVisualElement.Add(new Label("Hello"));\n}\n')),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/uie-howto-customeditor-window-hello.png",alt:"\u5e26\u6709Hello\u6807\u7b7e\u7684\u7a97\u53e3"})),(0,o.kt)("p",null,"\u5e26\u6709\u201cHello\u201d\u6807\u7b7e\u7684\u7a97\u53e3"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"\u6ce8\u610f"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"To present a list of sprites, use ",(0,o.kt)("inlineCode",{parentName:"td"},"AssetDatabase")," functions to find all sprites in a project.")))),(0,o.kt)("p",null,"Replace the code inside ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," with the code below to enumerate all sprites inside the project."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'public void CreateGUI()\n{\n  // Get a list of all sprites in the project\n  var allObjectGuids = AssetDatabase.FindAssets("t:Sprite");\n  var allObjects = new List&lt;Sprite&gt;();\n  foreach (var guid in allObjectGuids)\n  {\n    allObjects.Add(AssetDatabase.LoadAssetAtPath&lt;Sprite&gt;(AssetDatabase.GUIDToAssetPath(guid)));\n  }\n}\n')),(0,o.kt)("p",null,"For the sprite browser, the top-level visual element will be a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.TwoPaneSplitView.html"},"TwoPaneSplitView"),". This control splits the available window space into two panes: one fixed-size and one flexible-size. When you resize the window, only the flexible pane resizes, while the fixed-size pane remains the same size."),(0,o.kt)("p",null,"For the ",(0,o.kt)("inlineCode",{parentName:"p"},"TwoPaneSplitView")," control to work, it needs to have exactly two children. Add code inside ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," to create a ",(0,o.kt)("inlineCode",{parentName:"p"},"TwoPaneSplitview"),", then add two child elements as placeholders for different controls."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"// \u521b\u5efa\u4e00\u4e2a\u5305\u542b\u4e24\u4e2a\u7a97\u683c\u7684\u89c6\u56fe\uff0c\u5de6\u7a97\u683c\u56fa\u5b9a\nvar splitView = new TwoPaneSplitView(0, 250, TwoPaneSplitViewOrientation.Horizontal);\n\n// \u901a\u8fc7\u5c06\u89c6\u56fe\u4f5c\u4e3a\u5b50\u5143\u7d20\u6dfb\u52a0\u5230\u6839\u5143\u7d20\u6765\u5c06\u89c6\u56fe\u6dfb\u52a0\u5230\u53ef\u89c6\u5316\u6811\u4e2d\nrootVisualElement.Add(splitView);\n\n// \u4e00\u4e2a TwoPaneSplitView \u603b\u662f\u9700\u8981\u4e24\u4e2a\u5b50\u5143\u7d20\nvar leftPane = new VisualElement();\nsplitView.Add(leftPane);\nvar rightPane = new VisualElement();\nsplitView.Add(rightPane);\n")),(0,o.kt)("p",null,"\u4e0b\u56fe\u663e\u793a\u4e86\u5e26\u6709\u4e24\u4e2a\u7a7a\u9762\u677f\u7684\u81ea\u5b9a\u4e49\u7a97\u53e3\u3002\u5206\u5272\u680f\u53ef\u4ee5\u79fb\u52a8\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/uie-howto-customeditor-window-splitPane.png",alt:"\u5e26\u6709\u4e24\u4e2a\u62c6\u5206\u7a97\u683c\u7684\u7a97\u53e3"})),(0,o.kt)("p",null,"\u5e26\u6709\u4e24\u4e2a\u62c6\u5206\u7a97\u683c\u7684\u7a97\u53e3"),(0,o.kt)("p",null,"For the sprite browser, the left pane will be a list containing the names of all sprites found in the project. The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.ListView.html"},"ListView")," control derives from ",(0,o.kt)("inlineCode",{parentName:"p"},"VisualElement"),", so it\u2019s easy to modify the code to use a ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView")," instead of a blank ",(0,o.kt)("inlineCode",{parentName:"p"},"VisualElement"),"."),(0,o.kt)("p",null,"Modify the code inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," function to create a ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView")," control for the left pane instead of a ",(0,o.kt)("inlineCode",{parentName:"p"},"VisualElement"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"public void CreateGUI()\n{\n  ...\n  var leftPane = new ListView();\n  splitView.Add(leftPane);\n  ...\n}\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/UIElements.ListView.html"},"ListView")," control displays a list of selectable items. It\u2019s optimized to create only enough elements to cover the visible area, and pool and recycle the visual elements as you scroll the list. This optimizes performance and reduces the memory footprint, even in lists that have many items."),(0,o.kt)("p",null,"To take advantage of this, the ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView")," must be properly initialized with the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"An array of data items."),(0,o.kt)("li",{parentName:"ul"},"A callback function to create an individual visual list entry in the list."),(0,o.kt)("li",{parentName:"ul"},"A bind function that initializes a visual list entry with an item from the data array.")),(0,o.kt)("p",null,"You can create complex UI structures for each element in the list, but this example uses a simple text label to display the sprite name."),(0,o.kt)("p",null,"Add code to the bottom ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," function that initializes the ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"public void CreateGUI()\n{\n  ...\n  // \u4f7f\u7528\u6240\u6709\u7cbe\u7075\u7684\u540d\u79f0\u521d\u59cb\u5316\u5217\u8868\u89c6\u56fe\n  leftPane.makeItem = () =&gt; new Label();\n  leftPane.bindItem = (item, index) =&gt; { (item as Label).text = allObjects[index].name; };\n  leftPane.itemsSource = allObjects;\n}\n")),(0,o.kt)("p",null,"The image below shows the Editor window with a scrollable list view and selectable items."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/uie-howto-customeditor-listView.png",alt:"\u5e26\u6709\u7cbe\u7075\u540d\u79f0\u7684 ListView"})),(0,o.kt)("p",null,"\u5e26\u6709\u7cbe\u7075\u540d\u79f0\u7684 ListView"),(0,o.kt)("p",null,"\u4f5c\u4e3a\u53c2\u8003\uff0c\u4ee5\u4e0b\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," \u51fd\u6570\u7684\u5f53\u524d\u5b8c\u6574\u4ee3\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'public void CreateGUI()\n{\n  // Get a list of all sprites in the project\n  var allObjectGuids = AssetDatabase.FindAssets("t:Sprite");\n  var allObjects = new List&lt;Sprite&gt;();\n  foreach (var guid in allObjectGuids)\n  {\n    allObjects.Add(AssetDatabase.LoadAssetAtPath&lt;Sprite&gt;(AssetDatabase.GUIDToAssetPath(guid)));\n  }\n\n  // Create a two-pane view with the left pane being fixed with\n  var splitView = new TwoPaneSplitView(0, 250, TwoPaneSplitViewOrientation.Horizontal);\n\n  // Add the panel to the visual tree by adding it as a child to the root element\n  rootVisualElement.Add(splitView);\n\n  // A TwoPaneSplitView always needs exactly two child elements\n  var leftPane = new ListView();\n  splitView.Add(leftPane);\n  var rightPane = new VisualElement();\n  splitView.Add(rightPane);\n\n  // Initialize the list view with all sprites\' names\n  leftPane.makeItem = () =&gt; new Label();\n  leftPane.bindItem = (item, index) =&gt; { (item as Label).text = allObjects[index].name; };\n  leftPane.itemsSource = allObjects;\n}\n')),(0,o.kt)("h2",{id:"add-callbacks"},"Add callbacks"),(0,o.kt)("p",null,"When you select a sprite from the list in the left pane, its image must display on the right pane. To do this you need to provide a callback function that the ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView")," can call when the user makes a selection. The ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView")," control has an ",(0,o.kt)("inlineCode",{parentName:"p"},"onSelectionChange")," property for this purpose."),(0,o.kt)("p",null,"\u56de\u8c03\u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u5217\u8868\uff0c\u5176\u4e2d\u5305\u542b\u7528\u6237\u9009\u62e9\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u9879\u76ee\u3002\u53ef\u4ee5\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView")," \u914d\u7f6e\u4e3a\u5141\u8bb8\u591a\u9009\uff0c\u4f46\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9009\u62e9\u6a21\u5f0f\u4ec5\u9650\u4e8e\u5355\u4e2a\u9879\u76ee\u3002"),(0,o.kt)("p",null,"Add a callback function when the user changes the selection from the list in the left pane."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"public void CreateGUI()\n{\n  ...\n\n  // React to the user's selection\n  leftPane.onSelectionChange += OnSpriteSelectionChange;\n}\n\nprivate void OnSpriteSelectionChange(IEnumerable&lt;object&gt; selectedItems)\n{\n}\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"\u6ce8\u610f"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"If you lose your window and the menu doesn\u2019t reopen, close all floating panels through the menu under  ",(0,o.kt)("strong",{parentName:"td"},"Window"),"  ",">","  ",(0,o.kt)("strong",{parentName:"td"},"Panels"),"  ",">","  ",(0,o.kt)("strong",{parentName:"td"},"Close all floating panels")," , or reset your window layout.")))),(0,o.kt)("p",null,"To display the image of the selected sprite on the right side of the window, the function needs to be able to access the right-hand pane of the ",(0,o.kt)("inlineCode",{parentName:"p"},"TwoPaneSplitView"),". You can make this control a member variable of the class to be able to access it inside the callback function."),(0,o.kt)("p",null,"Turn the ",(0,o.kt)("inlineCode",{parentName:"p"},"rightPane")," created inside ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," into a member variable."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"private VisualElement m_RightPane;\n\npublic void CreateGUI()\n{\n  ...\n\n  m_RightPane = new VisualElement();\n  splitView.Add(m_RightPane);\n\n  ...\n}\n")),(0,o.kt)("p",null,"With a reference to the ",(0,o.kt)("inlineCode",{parentName:"p"},"TwoPaneSplitView"),", you can access the right pane via the ",(0,o.kt)("inlineCode",{parentName:"p"},"flexedPane")," property. Before creating a new ",(0,o.kt)("inlineCode",{parentName:"p"},"Image")," control on the right pane, use ",(0,o.kt)("inlineCode",{parentName:"p"},"VisualElement.Clear()")," to remove the previous image. This method removes all children from an existing visual element."),(0,o.kt)("p",null,"Clear the right pane from all previous content and create a new Image control for the selected sprite."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"private void OnSpriteSelectionChange(IEnumerable&lt;object&gt; selectedItems)\n{\n  // \u6e05\u9664\u7a97\u683c\u4e2d\u4e4b\u524d\u7684\u5168\u90e8\u5185\u5bb9\n  m_RightPane.Clear();\n\n  // \u83b7\u53d6\u9009\u5b9a\u7684\u7cbe\u7075\n  var selectedSprite = selectedItems.First() as Sprite;\n  if (selectedSprite == null)\n    return;\n\n  // \u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 Image \u63a7\u4ef6\u5e76\u663e\u793a\u7cbe\u7075\n  var spriteImage = new Image();\n  spriteImage.scaleMode = ScaleMode.ScaleToFit;\n  spriteImage.sprite = selectedSprite;\n\n  // \u5c06 Image \u63a7\u4ef6\u6dfb\u52a0\u5230\u53f3\u7a97\u683c\n  m_RightPane.Add(spriteImage);\n}\n")),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"\u6ce8\u610f"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Make sure to include ",(0,o.kt)("inlineCode",{parentName:"td"},"using System.Linq;")," at the top of your file to use the ",(0,o.kt)("inlineCode",{parentName:"td"},"First()")," method on the ",(0,o.kt)("inlineCode",{parentName:"td"},"selectedItems")," parameter.")))),(0,o.kt)("p",null,"Test your sprite browser in the Editor. The image below shows the custom Editor window in action."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/uie-howto-customeditor-window-final.png",alt:"\u6b63\u5728\u8fd0\u884c\u7684\u7cbe\u7075\u6d4f\u89c8\u5668"})),(0,o.kt)("p",null,"\u6b63\u5728\u8fd0\u884c\u7684\u7cbe\u7075\u6d4f\u89c8\u5668"),(0,o.kt)("h2",{id:"\u4f7f-ui-\u53ef\u8c03\u6574\u5927\u5c0f"},"\u4f7f UI \u53ef\u8c03\u6574\u5927\u5c0f"),(0,o.kt)("p",null,"\u7f16\u8f91\u5668\u7a97\u53e3\u53ef\u5728\u5176\u6700\u5c0f\u548c\u6700\u5927\u5141\u8bb8\u5c3a\u5bf8\u5185\u8c03\u6574\u5927\u5c0f\u3002\u901a\u8fc7\u5199\u5165 ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/EditorWindow.minSize.html"},"EditorWindow.minSize")," \u548c ",(0,o.kt)("a",{parentName:"p",href:"https://docs.unity3d.com/cn/2022.1/ScriptReference/EditorWindow.maxSize.html"},"EditorWindow.maxSize")," \u5c5e\u6027\uff0c\u60a8\u53ef\u4ee5\u5728\u521b\u5efa\u7a97\u53e3\u65f6\u4f7f\u7528 C# \u8bbe\u7f6e\u8fd9\u4e9b\u5c3a\u5bf8\u3002\u8981\u9632\u6b62\u7a97\u53e3\u8c03\u6574\u5927\u5c0f\uff0c\u8bf7\u4e3a\u8fd9\u4e24\u4e2a\u5c5e\u6027\u6307\u5b9a\u76f8\u540c\u7684\u5c3a\u5bf8\u3002"),(0,o.kt)("p",null,"Limit the size of your custom editor window by adding the following lines to the bottom of the ",(0,o.kt)("inlineCode",{parentName:"p"},"ShowMyEditor()")," function:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'[MenuItem("Tools/My Custom Editor")]\npublic static void ShowMyEditor()\n{\n  // \u5f53\u7528\u6237\u5728\u7f16\u8f91\u5668\u4e2d\u9009\u62e9\u83dc\u5355\u9879\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\n  EditorWindow wnd = GetWindow&lt;MyCustomEditor&gt;();\n  wnd.titleContent = new GUIContent("My Custom Editor");\n\n  // \u9650\u5236\u7a97\u53e3\u7684\u5927\u5c0f\n  wnd.minSize = new Vector2(450, 200);\n  wnd.maxSize = new Vector2(1920, 720);\n}\n')),(0,o.kt)("p",null,"For situations where the window dimensions are too small to display the entire UI, you must use a ",(0,o.kt)("inlineCode",{parentName:"p"},"ScrollView")," element to provide scrolling for the window, or the content might become inaccessible."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"ListView")," on the left pane is using a ",(0,o.kt)("inlineCode",{parentName:"p"},"ScrollView")," internally, but the right pane is a regular ",(0,o.kt)("inlineCode",{parentName:"p"},"VisualElement"),". Changing this to a ",(0,o.kt)("inlineCode",{parentName:"p"},"ScrollView")," control automatically displays scrollbars when the window is too small to fit the entire image in its original size."),(0,o.kt)("p",null,"Exchange the right pane ",(0,o.kt)("inlineCode",{parentName:"p"},"VisualElement")," for a ",(0,o.kt)("inlineCode",{parentName:"p"},"ScrollView")," with bidirectional scrolling."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"public void CreateGUI()\n{\n  ...\n\n  m_RightPane = new ScrollView(ScrollViewMode.VerticalAndHorizontal);\n  splitView.Add(m_RightPane);\n\n  ...\n}\n")),(0,o.kt)("p",null,"\u4e0b\u56fe\u663e\u793a\u4e86\u5e26\u6709\u6eda\u52a8\u6761\u7684\u7cbe\u7075\u6d4f\u89c8\u5668\u7a97\u53e3\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://docs.unity3d.com/cn/2022.1/uploads/Main/uie-howto-customeditor-window-scrollbars.png",alt:"\u5177\u6709\u6eda\u52a8\u6761\u7684\u7f16\u8f91\u5668\u7a97\u53e3"})),(0,o.kt)("p",null,"\u5177\u6709\u6eda\u52a8\u6761\u7684\u7f16\u8f91\u5668\u7a97\u53e3"),(0,o.kt)("p",null,"Close and reopen your custom Editor window to test out the new size limits."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"\u6ce8\u610f"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"In Unity 2021.2 and up, Unity doesn\u2019t respect the ",(0,o.kt)("inlineCode",{parentName:"td"},"minSize")," and ",(0,o.kt)("inlineCode",{parentName:"td"},"maxSize")," properties when the window is docked. This allows the user to resize dock areas without limitations. Consider creating a ",(0,o.kt)("inlineCode",{parentName:"td"},"ScrollView")," as one of your top-level elements and place all UI inside of it to make your UI as responsive as possible.")))),(0,o.kt)("h2",{id:"\u652f\u6301\u5728\u7f16\u8f91\u5668\u4e2d\u70ed\u91cd\u8f7d"},"\u652f\u6301\u5728\u7f16\u8f91\u5668\u4e2d\u70ed\u91cd\u8f7d"),(0,o.kt)("p",null,"A proper Editor window must work with the hot-reloading workflow that happens in the Unity Editor. A C# domain reload occurs when scripts recompile or when the Editor enters Play mode. You can learn more about this topic on the ",(0,o.kt)("a",{parentName:"p",href:"/docs/script-serialization"},"Script Serialization")," page."),(0,o.kt)("p",null,"To see this in action in the Editor window you just created, open the sprite browser, select a sprite, and then enter Play mode. The window resets, and the selection disappears."),(0,o.kt)("p",null,"Since ",(0,o.kt)("inlineCode",{parentName:"p"},"VisualElement")," objects aren\u2019t serializable, the UI must be recreated every time a reload happens in Unity. This means that the ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," method is invoked after the reload has completed. This lets you restore the UI state before the reload by storing necessary data in your ",(0,o.kt)("inlineCode",{parentName:"p"},"EditorWindow")," class."),(0,o.kt)("p",null,"Add a member variable to save the selected index in the sprite list."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"public class MyCustomEditor : EditorWindow\n{\n    [SerializeField] private int m_SelectedIndex = -1;\n\n    ....\n}\n")),(0,o.kt)("p",null,"When you make a selection, the new selection index of the list view can be stored inside this member variable. You can restore the selection index during creation of the UI inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," function."),(0,o.kt)("p",null,"Add code to the end of the ",(0,o.kt)("inlineCode",{parentName:"p"},"CreateGUI()")," function to store and restore the selected list index."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"public void CreateGUI()\n{\n  ...\n\n  // \u6062\u590d\u70ed\u91cd\u8f7d\u524d\u7684\u9009\u62e9\u7d22\u5f15\n  leftPane.selectedIndex = m_SelectedIndex;\n\n  // \u9009\u62e9\u66f4\u6539\u65f6\u5b58\u50a8\u9009\u62e9\u7d22\u5f15\n  leftPane.onSelectionChange += (items) =&gt; { m_SelectedIndex = leftPane.selectedIndex; };\n}\n")),(0,o.kt)("p",null,"Select a sprite from the list and enter Play mode to test hot-reloading."),(0,o.kt)("h2",{id:"editor-window-script"},"Editor window script"),(0,o.kt)("p",null,"The code below is the final script of the Editor window created during this guide. You can paste the code directly into a file called ",(0,o.kt)("inlineCode",{parentName:"p"},"MyCustomEdtior.cs")," inside the  ",(0,o.kt)("strong",{parentName:"p"},"Assets/Editor"),"  folder to see it in the Unity Editor."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'using System.Collections.Generic;\nusing System.Linq;\nusing UnityEditor;\nusing UnityEngine;\nusing UnityEngine.UIElements;\n\npublic class MyCustomEditor : EditorWindow\n{\n  [SerializeField] private int m_SelectedIndex = -1;\n  private VisualElement m_RightPane;\n\n  [MenuItem("Tools/My Custom Editor")]\n  public static void ShowMyEditor()\n  {\n    // This method is called when the user selects the menu item in the Editor\n    EditorWindow wnd = GetWindow&lt;MyCustomEditor&gt;();\n    wnd.titleContent = new GUIContent("My Custom Editor");\n\n    // Limit size of the window\n    wnd.minSize = new Vector2(450, 200);\n    wnd.maxSize = new Vector2(1920, 720);\n  }\n\n  public void CreateGUI()\n  {\n    // Get a list of all sprites in the project\n    var allObjectGuids = AssetDatabase.FindAssets("t:Sprite");\n    var allObjects = new List&lt;Sprite&gt;();\n    foreach (var guid in allObjectGuids)\n    {\n      allObjects.Add(AssetDatabase.LoadAssetAtPath&lt;Sprite&gt;(AssetDatabase.GUIDToAssetPath(guid)));\n    }\n\n    // Create a two-pane view with the left pane being fixed with\n    var splitView = new TwoPaneSplitView(0, 250, TwoPaneSplitViewOrientation.Horizontal);\n\n    // Add the panel to the visual tree by adding it as a child to the root element\n    rootVisualElement.Add(splitView);\n\n    // A TwoPaneSplitView always needs exactly two child elements\n    var leftPane = new ListView();\n    splitView.Add(leftPane);\n    m_RightPane = new ScrollView(ScrollViewMode.VerticalAndHorizontal);\n    splitView.Add(m_RightPane);\n\n    // Initialize the list view with all sprites\' names\n    leftPane.makeItem = () =&gt; new Label();\n    leftPane.bindItem = (item, index) =&gt; { (item as Label).text = allObjects[index].name; };\n    leftPane.itemsSource = allObjects;\n\n    // React to the user\'s selection\n    leftPane.onSelectionChange += OnSpriteSelectionChange;\n\n    // Restore the selection index from before the hot reload\n    leftPane.selectedIndex = m_SelectedIndex;\n\n    // Store the selection index when the selection changes\n    leftPane.onSelectionChange += (items) =&gt; { m_SelectedIndex = leftPane.selectedIndex; };\n  }\n\n  private void OnSpriteSelectionChange(IEnumerable&lt;object&gt; selectedItems)\n  {\n    // Clear all previous content from the pane\n    m_RightPane.Clear();\n\n    // Get the selected sprite\n    var selectedSprite = selectedItems.First() as Sprite;\n    if (selectedSprite == null)\n      return;\n\n    // Add a new Image control and display the sprite\n    var spriteImage = new Image();\n    spriteImage.scaleMode = ScaleMode.ScaleToFit;\n    spriteImage.sprite = selectedSprite;\n\n    // Add the Image control to the right-hand pane\n    m_RightPane.Add(spriteImage);\n  }\n}\n\n')))}u.isMDXComponent=!0}}]);