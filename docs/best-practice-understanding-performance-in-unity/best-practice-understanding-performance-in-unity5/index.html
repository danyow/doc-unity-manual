<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/doc-unity-manual/blog/rss.xml" title="Unity 手册 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/doc-unity-manual/blog/atom.xml" title="Unity 手册 Atom Feed"><title data-rh="true">字符串和文本 | Unity 手册</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://danyow.github.io/doc-unity-manual//doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity5"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="字符串和文本 | Unity 手册"><meta data-rh="true" name="description" content="字符串和文本的处理不当是 Unity 项目中性能问题的常见原因。在 C# 中，所有字符串均不可变。对字符串的任何操作均会导致分配一个完整的新字符串。这种操作的代价相对比较高，而且在大型字符串上、大型数据集上或紧凑循环中执行时，接连不断的重复的字符串可能发展成性能问题。"><meta data-rh="true" property="og:description" content="字符串和文本的处理不当是 Unity 项目中性能问题的常见原因。在 C# 中，所有字符串均不可变。对字符串的任何操作均会导致分配一个完整的新字符串。这种操作的代价相对比较高，而且在大型字符串上、大型数据集上或紧凑循环中执行时，接连不断的重复的字符串可能发展成性能问题。"><link data-rh="true" rel="icon" href="/doc-unity-manual/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://danyow.github.io/doc-unity-manual//doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity5"><link data-rh="true" rel="alternate" href="https://danyow.github.io/doc-unity-manual//doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity5" hreflang="zh"><link data-rh="true" rel="alternate" href="https://danyow.github.io/doc-unity-manual//doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity5" hreflang="x-default"><link rel="stylesheet" href="/doc-unity-manual/assets/css/styles.3b98a603.css">
<link rel="preload" href="/doc-unity-manual/assets/js/runtime~main.fe6cf380.js" as="script">
<link rel="preload" href="/doc-unity-manual/assets/js/main.53b1625e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doc-unity-manual/"><div class="navbar__logo"><img src="/doc-unity-manual/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/doc-unity-manual/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">My Site</b></a><a class="navbar__item navbar__link navbar__link--active" href="/doc-unity-manual/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/doc-unity-manual/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="切换浅色/暗黑模式（当前为浅色模式）"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc-unity-manual/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc-unity-manual/docs/tutorial-basics/create-a-page">Tutorial - Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc-unity-manual/docs/tutorial-extras/manage-docs-versions">Tutorial - Extras</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/animation-section">animation-section</a><button aria-label="打开/收起侧边栏菜单「animation-section」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/asset-store">asset-store</a><button aria-label="打开/收起侧边栏菜单「asset-store」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/asset-workflow">asset-workflow</a><button aria-label="打开/收起侧边栏菜单「asset-workflow」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/audio">audio</a><button aria-label="打开/收起侧边栏菜单「audio」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/creating-environments">creating-environments</a><button aria-label="打开/收起侧边栏菜单「creating-environments」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc-unity-manual/docs/Glossary">术语表</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/graphics">graphics</a><button aria-label="打开/收起侧边栏菜单「graphics」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/input">input</a><button aria-label="打开/收起侧边栏菜单「input」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/legacy-topics">legacy-topics</a><button aria-label="打开/收起侧边栏菜单「legacy-topics」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/navigation">navigation</a><button aria-label="打开/收起侧边栏菜单「navigation」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/open-source-repositories">open-source-repositories</a><button aria-label="打开/收起侧边栏菜单「open-source-repositories」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/packages-list">packages-list</a><button aria-label="打开/收起侧边栏菜单「packages-list」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/physics-section">physics-section</a><button aria-label="打开/收起侧边栏菜单「physics-section」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/platform-specific">platform-specific</a><button aria-label="打开/收起侧边栏菜单「platform-specific」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/scripting-section">scripting-section</a><button aria-label="打开/收起侧边栏菜单「scripting-section」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/search-overview">search-overview</a><button aria-label="打开/收起侧边栏菜单「search-overview」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/uitoolkits">uitoolkits</a><button aria-label="打开/收起侧边栏菜单「uitoolkits」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/unet">unet</a><button aria-label="打开/收起侧边栏菜单「unet」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc-unity-manual/docs/unity-manual">unity-manual</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/doc-unity-manual/docs/unity-overview">unity-overview</a><button aria-label="打开/收起侧边栏菜单「unity-overview」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0" href="/doc-unity-manual/docs/analysis">analysis</a><button aria-label="打开/收起侧边栏菜单「analysis」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/analysis/async-read-manager-metrics">资源加载指标</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity">best-practice-understanding-performance-in-unity</a><button aria-label="打开/收起侧边栏菜单「best-practice-understanding-performance-in-unity」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity4">资源审核</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity5">字符串和文本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity6">Resources 文件夹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity7">一般优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity8">特别优化</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/analysis/log-files">Log files</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/performance-memory-overview">performance-memory-overview</a><button aria-label="打开/收起侧边栏菜单「performance-memory-overview」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/performance-profiling-tools">performance-profiling-tools</a><button aria-label="打开/收起侧边栏菜单「performance-profiling-tools」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/profiler">profiler</a><button aria-label="打开/收起侧边栏菜单「profiler」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/creating-gameplay">creating-gameplay</a><button aria-label="打开/收起侧边栏菜单「creating-gameplay」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/editor-features">editor-features</a><button aria-label="打开/收起侧边栏菜单「editor-features」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/getting-started-installing-unity">getting-started-installing-unity</a><button aria-label="打开/收起侧边栏菜单「getting-started-installing-unity」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/quickstart-guides">quickstart-guides</a><button aria-label="打开/收起侧边栏菜单「quickstart-guides」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/upgrade-guides">upgrade-guides</a><button aria-label="打开/收起侧边栏菜单「upgrade-guides」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/doc-unity-manual/docs/using-the-editor">using-the-editor</a><button aria-label="打开/收起侧边栏菜单「using-the-editor」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/unity-services">unity-services</a><button aria-label="打开/收起侧边栏菜单「unity-services」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/unity2d">unity2d</a><button aria-label="打开/收起侧边栏菜单「unity2d」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/video-player">video-player</a><button aria-label="打开/收起侧边栏菜单「video-player」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/doc-unity-manual/docs/xr">xr</a><button aria-label="打开/收起侧边栏菜单「xr」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/doc-unity-manual/">🏠</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/doc-unity-manual/docs/unity-overview">unity-overview</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/doc-unity-manual/docs/analysis">analysis</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity">best-practice-understanding-performance-in-unity</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity5">字符串和文本</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>字符串和文本</h1><p>字符串和文本的处理不当是 Unity 项目中性能问题的常见原因。在 C# 中，所有字符串均不可变。对字符串的任何操作均会导致分配一个完整的新字符串。这种操作的代价相对比较高，而且在大型字符串上、大型数据集上或紧凑循环中执行时，接连不断的重复的字符串可能发展成性能问题。</p><p>此外，由于 N 个字符串连接需要分配 N–1 个中间字符串，串行连接也可能成为托管内存压力的主要原因。</p><p>如果必须在紧凑循环中或每帧期间对字符串进行连接，请使用 StringBuilder 执行实际连接操作。为最大限度减少不必要的内存分配，可重复使用 StringBuilder 实例。</p><p>Microsoft 整理了一份处理 C# 中的字符串的最佳做法清单，可在这里的 MSDN 网站上找到该清单：<a href="https://msdn.microsoft.com/en-us/library/dd465121(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">msdn.microsoft.com</a>。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="区域约束与序数比对">区域约束与序数比对<a class="hash-link" href="#区域约束与序数比对" title="标题的直接链接">​</a></h2><p>在与字符串相关的代码中经常出现的核心性能问题之一是无意间使用了缓慢的默认字符串 API。这些 API 是为商业应用程序构建的，可根据与文本字符有关的多种不同区域性和语言规则来处理字符串。</p><p>For example, the following example code returns true when run under the US-English locale, but returns false for many European locales.</p><p> <strong>Note</strong> : As of Unity 5.3 and 5.4, Unity’s scripting runtimes always run under the US English (en-US) locale:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    String.Equals(&quot;encyclopedia&quot;, &quot;encyclopædia&quot;);</span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_wuS7 clean-btn">复制</button></div></div><p>For most Unity projects, this is entirely unnecessary. It’s roughly ten times faster to use the ordinal comparison type, which compares strings in a manner familiar to C and C++ programmers: by simply comparing each sequential byte of the string, without regard for the character represented by that byte.</p><p>切换至序数比对的方式非常简单，只需将 <code>StringComparison.Ordinal</code> 作为最终参数提供给 <code>String.Equals</code>：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">myString.Equals(otherString, StringComparison.Ordinal);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_wuS7 clean-btn">复制</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="低效的内置字符串-api">低效的内置字符串 API<a class="hash-link" href="#低效的内置字符串-api" title="标题的直接链接">​</a></h2><p>Beyond switching to ordinal comparisons, certain C# <code>String</code> APIs are known to be extremely inefficient. Among these are <code>String.Format</code>, <code>String.StartsWith</code> and <code>String.EndsWith</code>. <code>String.Format</code> is difficult to replace, but the inefficient string comparison methods are trivially optimized away.</p><p>While Microsoft’s recommendation is to pass <code>StringComparison.Ordinal</code> into any string comparison that doesn’t need to be adjusted for localization, Unity benchmarks show that the impact of this is relatively minimal compared to a custom implementation.</p><table><thead><tr><th>方法</th><th>100k 短字符串的时间（毫秒）</th></tr></thead><tbody><tr><td><code>String.StartsWith</code>，默认区域性</td><td>137</td></tr><tr><td><code>String.EndsWith</code>, default culture</td><td>542</td></tr><tr><td><code>String.StartsWith</code>，序数</td><td>115</td></tr><tr><td><code>String.EndsWith</code>，序数</td><td>34</td></tr><tr><td>自定义 <code>StartsWith</code> 替换</td><td>4.5</td></tr><tr><td>自定义 <code>EndsWith</code> 替换</td><td>4.5</td></tr></tbody></table><p><code>String.StartsWith</code> 和 <code>String.EndsWith</code> 均可以替换为类似于以下示例的简单的手工编码版本。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static bool CustomEndsWith(this string a, string b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int ap = a.Length - 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int bp = b.Length - 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (ap &amp;gt;= 0 &amp;&amp; bp &amp;gt;= 0 &amp;&amp; a [ap] == b [bp])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ap--;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bp--;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (bp &amp;lt; 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static bool CustomStartsWith(this string a, string b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int aLen = a.Length;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int bLen = b.Length;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int ap = 0; int bp = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (ap &amp;lt; aLen &amp;&amp; bp &amp;lt; bLen &amp;&amp; a [ap] == b [bp])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ap++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bp++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (bp == bLen);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_wuS7 clean-btn">复制</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="正则表达式">正则表达式<a class="hash-link" href="#正则表达式" title="标题的直接链接">​</a></h2><p>While Regular Expressions are a powerful way to match and manipulate strings, they can be extremely performance-intensive. Further, due to the C# library’s implementation of Regular Expressions, even simple Boolean <code>IsMatch</code> queries allocate large transient datastructures “under the hood.” This transient managed memory churn should be deemed unacceptable, except during initialization.</p><p>If regular expressions are necessary, it’s strongly recommended to not use the static <code>Regex.Match</code> or <code>Regex.Replace</code> methods, which accept the regular expression as a string parameter. These methods compile the regular expression on-the-fly and don’t cache the generated object.</p><p>以下示例代码为无害的单行代码。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Regex.Match(myString, &quot;foo&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_wuS7 clean-btn">复制</button></div></div><p>但是，该代码每次执行时会产生 5 KB 的垃圾。通过简单的重构即可消除其中的大部分垃圾：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var myRegExp = new Regex(&quot;foo&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myRegExp.Match(myString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_wuS7 clean-btn">复制</button></div></div><p>In this example, each call to <code>myRegExp.Match</code> “only” results in 320 bytes of garbage. While this is still expensive for a simple matching operation, it’s a considerable improvement over the previous example.</p><p>Therefore, if the regular expressions are invariant string literals, it’s considerably more efficient to precompile them by passing them as the first parameter of the Regex object’s constructor. These precompiled Regexes should then be reused.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="xmljson-和其他长格式文本解析">XML、JSON 和其他长格式文本解析<a class="hash-link" href="#xmljson-和其他长格式文本解析" title="标题的直接链接">​</a></h2><p>Parsing text is often one of the heaviest operations that occurs at loading time. Sometimes, the time spent parsing text can outweigh the time spent loading and instantiating Assets.</p><p>The reasons behind this depend on the specific parser used. C#’s built-in XML parser is extremely flexible, but as a result, it’s not optimizable for specific data layouts.</p><p>Many third-party parsers are built on reflection. While reflection is an excellent choice during development (because it allows the parser to rapidly adapt to changing data layouts), it’s notoriously slow.</p><p>Unity has introduced a partial solution with its built-in <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/JsonUtility.html" target="_blank" rel="noopener noreferrer">JSONUtility</a> API, which provides an interface to Unity’s serialization system that reads/emits JSON. In most benchmarks, it’s faster than pure C# JSON parsers, but it has the same limitations as other interfaces to Unity’s serialization system – it can’t serialized many complex data types, such as Dictionaries, without additional code.</p><p> <strong>Note</strong> : See the <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/ISerializationCallbackReceiver.html" target="_blank" rel="noopener noreferrer">ISerializationCallbackReceiver</a> interface for one way to add the additional processing necessary to convert to/from complex data types during Unity’s serialization process.</p><p>当遇到文本数据解析所引起的性能问题时，请考虑三种替代解决方案。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="方案-1在构建时解析">方案 1：在构建时解析<a class="hash-link" href="#方案-1在构建时解析" title="标题的直接链接">​</a></h3><p>避免文本解析成本的最佳方法是完全取消运行时文本解析。通常，这意味着通过某种构建步骤将文本数据“烘焙”成二进制格式。</p><p>大多数选择使用该方法的开发者会将其数据移动到某种 ScriptableObject 衍生的类层级视图中，然后通过 AssetBundle 分配数据。有关使用 ScriptableObjects 的精彩讨论，请参阅 youtube 上 <a href="https://www.youtube.com/watch?v=VBA1QCoEAX4" target="_blank" rel="noopener noreferrer">Richard Fine 的 Unite 2016 讲座</a>。</p><p>This strategy offers the best possible performance, but is only suitable for data that doesn’t need to be generated dynamically. it’s best suited for game design parameters and other content.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="方案-2拆分和延迟加载">方案 2：拆分和延迟加载<a class="hash-link" href="#方案-2拆分和延迟加载" title="标题的直接链接">​</a></h3><p>第二种可行的方法是将必须解析的数据拆分为较小的数据块。拆分后，解析数据的成本可分摊到多个帧。在理想的情况下，可识别出为用户提供所需体验而需要的特定数据部分，然后只加载这些部分。</p><p>举一个简单的例子：如果项目为平台游戏，则没必要将所有关卡的数据一起序列。如果将数据拆分为每个关卡的独立资源，并且将关卡划分到区域中，则可以在玩家闯关到相应位置时再解析数据。</p><p>虽然这听起来不难，但实际上需要在工具编码方面投入大量精力，并可能需要重组数据结构。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="方案-3线程">方案 3：线程<a class="hash-link" href="#方案-3线程" title="标题的直接链接">​</a></h3><p>For data that’s parsed entirely into plain C# objects, and doesn’t require any interaction with Unity APIs, it’s possible to move the parsing operations to worker threads.</p><p>This option can be extremely powerful on platforms with a significant number of cores. However, it requires careful programming to avoid creating deadlocks and race conditions.</p><p> <strong>Note</strong> : iOS devices have at most 2 cores. Most Android devices have from 2 to 4. This technique of more interest when building for standalone and console build targets.</p><p>Projects that choose to implement threading use the built-in C# <a href="https://msdn.microsoft.com/en-us/library/system.threading.thread(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">Thread</a> and <a href="https://msdn.microsoft.com/en-us/library/system.threading.threadpool(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">ThreadPool</a> classes (see <a href="https://msdn.microsoft.com/en-us/library/system.threading.thread(v=vs.110).aspx" target="_blank" rel="noopener noreferrer">msdn.microsoft.com</a>) to manage their worker threads, along with the standard C# synchronization classes.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/unity-overview/analysis/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity5.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity4"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">资源审核</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/doc-unity-manual/docs/best-practice-understanding-performance-in-unity/best-practice-understanding-performance-in-unity6"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Resources 文件夹</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#区域约束与序数比对" class="table-of-contents__link toc-highlight">区域约束与序数比对</a></li><li><a href="#低效的内置字符串-api" class="table-of-contents__link toc-highlight">低效的内置字符串 API</a></li><li><a href="#正则表达式" class="table-of-contents__link toc-highlight">正则表达式</a></li><li><a href="#xmljson-和其他长格式文本解析" class="table-of-contents__link toc-highlight">XML、JSON 和其他长格式文本解析</a><ul><li><a href="#方案-1在构建时解析" class="table-of-contents__link toc-highlight">方案 1：在构建时解析</a></li><li><a href="#方案-2拆分和延迟加载" class="table-of-contents__link toc-highlight">方案 2：拆分和延迟加载</a></li><li><a href="#方案-3线程" class="table-of-contents__link toc-highlight">方案 3：线程</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/doc-unity-manual/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/doc-unity-manual/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/doc-unity-manual/assets/js/runtime~main.fe6cf380.js"></script>
<script src="/doc-unity-manual/assets/js/main.53b1625e.js"></script>
</body>
</html>