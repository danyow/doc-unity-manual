<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Unity ÊâãÂÜå RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Unity ÊâãÂÜå Atom Feed"><title data-rh="true">DOTS Instancing shaders | Unity ÊâãÂÜå</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://danyow.github.io/doc-unity-manual//docs/batch-renderer-group/dots-instancing-shaders"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DOTS Instancing shaders | Unity ÊâãÂÜå"><meta data-rh="true" name="description" content="To render large instance counts efficiently, BRG uses a new shader instancing mode called DOTS Instancing. Every shader that BRG uses must support DOTS Instancing. In traditional instanced shaders, the shader is passed an array for each instanced property in a constant or uniform buffer, such that each element in each array contains the property value for a single instance in the draw. In DOTS Instanced shaders, Unity passes one 32-bit integer to the shader for each DOTS Instanced property. This 32-bit integer is called a metadata value. This integer can represent anything you want, but typically you use it to pass a buffer offset from where the shader can then load the property value for the instance it is rendering."><meta data-rh="true" property="og:description" content="To render large instance counts efficiently, BRG uses a new shader instancing mode called DOTS Instancing. Every shader that BRG uses must support DOTS Instancing. In traditional instanced shaders, the shader is passed an array for each instanced property in a constant or uniform buffer, such that each element in each array contains the property value for a single instance in the draw. In DOTS Instanced shaders, Unity passes one 32-bit integer to the shader for each DOTS Instanced property. This 32-bit integer is called a metadata value. This integer can represent anything you want, but typically you use it to pass a buffer offset from where the shader can then load the property value for the instance it is rendering."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://danyow.github.io/doc-unity-manual//docs/batch-renderer-group/dots-instancing-shaders"><link data-rh="true" rel="alternate" href="http://danyow.github.io/doc-unity-manual//docs/batch-renderer-group/dots-instancing-shaders" hreflang="zh"><link data-rh="true" rel="alternate" href="http://danyow.github.io/doc-unity-manual//docs/batch-renderer-group/dots-instancing-shaders" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3b98a603.css">
<link rel="preload" href="/assets/js/runtime~main.13c240a3.js" as="script">
<link rel="preload" href="/assets/js/main.8f4a8c68.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">My Site</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="ÂõûÂà∞È°∂ÈÉ®" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/tutorial-basics/create-a-page">Tutorial - Basics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/tutorial-extras/manage-docs-versions">Tutorial - Extras</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/animation-section">animation-section</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåanimation-section„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/asset-store">asset-store</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåasset-store„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/asset-workflow">asset-workflow</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåasset-workflow„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/audio">audio</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåaudio„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/creating-environments">creating-environments</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåcreating-environments„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Glossary">ÊúØËØ≠Ë°®</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/graphics">graphics</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äågraphics„Äç" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/cameras-overview">cameras-overview</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåcameras-overview„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/graphics-apis">graphics-apis</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äågraphics-apis„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/graphics-color">graphics-color</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äågraphics-color„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0" href="/docs/graphics-performance-profiling">graphics-performance-profiling</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äågraphics-performance-profiling„Äç" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" tabindex="0" href="/docs/batch-renderer-group">batch-renderer-group</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåbatch-renderer-group„Äç" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/batch-renderer-group-creating-a-renderer">batch-renderer-group-creating-a-renderer</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåbatch-renderer-group-creating-a-renderer„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/batch-renderer-group/batch-renderer-group-getting-started">Getting started with BatchRendererGroup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/batch-renderer-group/batch-renderer-group-how">How BatchRendererGroup works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/batch-renderer-group/dots-instancing-shaders">DOTS Instancing shaders</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/graphics-performance-profiling/frame-debugger">The Frame Debugger window</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/optimizing-draw-calls">optimizing-draw-calls</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåoptimizing-draw-calls„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/graphics-performance-profiling/optimizing-graphics-performance">Graphics performance fundamentals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/graphics-performance-profiling/rendering-statistics">The Rendering Statistics window</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/lighting-overview">lighting-overview</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äålighting-overview„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/materials">materials</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåmaterials„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/mesh">mesh</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåmesh„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/models">models</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåmodels„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/render-pipelines">render-pipelines</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äårender-pipelines„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/shaders">shaders</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåshaders„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/sky">sky</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåsky„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/textures">textures</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåtextures„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/visual-effects">visual-effects</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåvisual-effects„Äç" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/input">input</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåinput„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/legacy-topics">legacy-topics</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äålegacy-topics„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/navigation">navigation</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äånavigation„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/open-source-repositories">open-source-repositories</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåopen-source-repositories„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/packages-list">packages-list</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåpackages-list„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/physics-section">physics-section</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåphysics-section„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/platform-specific">platform-specific</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåplatform-specific„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/scripting-section">scripting-section</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåscripting-section„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/search-overview">search-overview</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåsearch-overview„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/uitoolkits">uitoolkits</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåuitoolkits„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/unet">unet</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåunet„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/unity-manual">unity-manual</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/unity-overview">unity-overview</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåunity-overview„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/unity-services">unity-services</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåunity-services„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/unity2d">unity2d</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåunity2d„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/video-player">video-player</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåvideo-player„Äç" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/xr">xr</a><button aria-label="ÊâìÂºÄ/Êî∂Ëµ∑‰æßËæπÊ†èËèúÂçï„Äåxr„Äç" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/graphics">graphics</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/graphics-performance-profiling">graphics-performance-profiling</a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/batch-renderer-group">batch-renderer-group</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docs/batch-renderer-group/dots-instancing-shaders">DOTS Instancing shaders</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">Êú¨È°µÊÄªËßà</button></div><div class="theme-doc-markdown markdown"><h1>DOTS Instancing shaders</h1><p>To render large instance counts efficiently, BRG uses a new shader instancing mode called DOTS Instancing. Every shader that BRG uses must support DOTS Instancing. In traditional instanced shaders, the shader is passed an array for each instanced property in a constant or uniform buffer, such that each element in each array contains the property value for a single instance in the draw. In DOTS Instanced shaders, Unity passes one 32-bit integer to the shader for each DOTS Instanced property. This 32-bit integer is called a metadata value. This integer can represent anything you want, but typically you use it to pass a buffer offset from where the shader can then load the property value for the instance it is rendering.</p><p>DOTS Instancing brings many advantages compared to traditional instancing, including the following:</p><ul><li>The instance data is stored in a GraphicsBuffer and remains persistent on the GPU, which means that Unity doesn‚Äôt need to set it up again each time it renders the instance. Setting up the data only when it actually changes can bring very large performance increases in cases where the data changes only rarely or doesn‚Äôt change at all. This is compared to traditional instancing which sets up all data for every instance every frame.</li><li>The process for setting up instance data is separate from setting up the draw call, which allows the draw call setup to be very lightweight and efficient. To achieve this, BRG uses a special fast path of the SRP Batcher which only does a minimal amount of work for each draw call.</li><li>The size of the draw call is no longer limited by how much instance data can fit in a constant or uniform buffer. This allows BRG to render larger instance counts with a single draw call. The number of instance indices still limits the draw call, but they take a lot less space than a full set of instanced properties, so many more can fit inside a constant or uniform buffer.</li><li>If every instance uses the same value for a given property, it is possible to have all instances load the value from the same place in memory. This saves memory and the resource intensity of the setup associated with duplicating the value for each instance.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="supporting-dots-instancing">Supporting DOTS Instancing<a class="hash-link" href="#supporting-dots-instancing" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>To support DOTS Instancing, a shader needs to do the following:</p><ul><li><p>Use shader model 4.5 or newer, so it must specify <code>#pragma target 4.5</code> or higher.</p></li><li><p>Support the <code>DOTS_INSTANCING_ON</code> keyword. To declare this, use <code>#pragma multi_compile _ DOTS_INSTANCING_ON</code>.</p></li><li><p>Declare at least one block of DOTS Instanced properties with at least one property. For more information, see <a href="#declaring-dots-instanced-properties">Declaring DOTS Instanced properties</a>.</p><p><strong>Note</strong> : Shader Graphs and shaders that Unity provides in URP and HDRP support DOTS Instancing.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="declaring-dots-instanced-properties">Declaring DOTS Instanced properties<a class="hash-link" href="#declaring-dots-instanced-properties" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>To load instance data such as transform matrices, the shader needs to define DOTS Instanced properties. Below is an example of a simple DOTS Instanced property block:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">UNITY_DOTS_INSTANCING_START(MaterialPropertyMetadata)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UNITY_DOTS_INSTANCED_PROP(float4, Color)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UNITY_DOTS_INSTANCING_END(MaterialPropertyMetadata)</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" class="copyButton_wuS7 clean-btn">Â§çÂà∂</button></div></div><p>To mark the beginning and the end of the property block, use the <code>UNITY_DOTS_INSTANCING_START</code> and <code>UNITY_DOTS_INSTANCING_END</code> macros followed by the name of the block. The above example uses <code>MaterialPropertyMetadata</code> as the name. There are three allowed names:</p><ul><li>BuiltinPropertyMetadata</li><li>MaterialPropertyMetadata</li><li>UserPropertyMetadata</li></ul><p>The shader can declare up to one of each, so a DOTS Instanced shader can have between 1 and 3 of such blocks. The block names don‚Äôt affect functionality directly. Unity-defined shader code doesn‚Äôt use UserPropertyMetadata so this name is guaranteed to be free for you to use. URP and HDRP define BuiltinPropertyMetadata for every shader they provide and define MaterialPropertyMetadata for most of them too. Your custom shaders can use all three.</p><p>The block can contain any number of DOTS Instanced property definitions formatted like:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">UNITY_DOTS_INSTANCED_PROP(PropertyType, PropertyName)</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" class="copyButton_wuS7 clean-btn">Â§çÂà∂</button></div></div><p><code>PropertyType</code> can be any HLSL built-in type (like uint, float4, float4x4, or int2x4) except a bool vector, and <code>PropertyName</code> is the name of the DOTS Instanced property. DOTS Instanced properties are completely separate from regular material properties, and you can give them the same name as another regular material property. This is possible because the <code>UNITY_DOTS_INSTANCED_PROP</code> macro generates special constant names which Unity recognizes, but don‚Äôt conflict with other property names. Shaders that Unity provides use the convention where DOTS Instanced properties have the same names as regular material properties, but you don‚Äôt need to follow this convention.</p><p>Internally, Unity provides the shader with a 32-bit integer metadata value for every DOTS Instanced property the shader declares. Unity sets the metadata value when your code makes a <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchRendererGroup.AddBatch.html" target="_blank" rel="noopener noreferrer">BatchRendererGroup.AddBatch</a> call to create the batch associated with the draw. The metadata value defaults to <code>0</code> if Unity doesn‚Äôt set it. The shader also has access to <code>ByteAddressBuffer unity_DOTSInstanceData</code> which Unity sets to the GraphicsBuffer your code uses as the argument to <code>BatchRendererGroup.AddBatch</code>. This is typically where the shader loads the instance data from. Different batches can use different GraphicsBuffers for <code>unity_DOTSInstanceData</code>, or multiple batches can share a single GraphicsBuffer.</p><p> <strong>Note</strong> : Unity doesn‚Äôt provide any DOTS Instanced data automatically. It‚Äôs your responsibility to make sure that the <code>unity_DOTSInstanceData</code> buffer of each batch contains the correct data. This includes many properties which are normally built-in properties for GameObjects, such as transform matrices, light probe coefficients, and lightmap texture coordinates.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="accessing-dots-instanced-properties">Accessing DOTS Instanced properties<a class="hash-link" href="#accessing-dots-instanced-properties" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>To access DOTS Instanced properties, your shader can use one of the access macros that Unity provides. The access macros assume that the layout of instance data in <code>unity_DOTSInstanceData</code> uses the following layout:</p><ul><li>The 31 least significant bits of the metadata value contain the byte address inside <code>unity_DOTSInstanceData</code> that stores the value for instance index zero.</li><li>If the most significant bit of the metadata value is <code>0</code>, every instance uses the value from instance index zero. They load directly from the byte address in the metadata value. In this case, the buffer only needs to store a single value, instead of one value per instance.</li><li>If the most significant bit of the metadata value is <code>1</code>, the address should contain an array where you can find the value for instance index <code>instanceID</code> using <code>AddressOfInstance0 + sizeof(PropertyType) * instanceID</code>. In this case, you should ensure that every rendered instance index has valid data inside the buffer. Otherwise, out-of-bounds access and undefined behavior can occur.</li></ul><p>You can also use the metadata value directly which is useful if you want to use a custom data source that doesn‚Äôt use the above layout, such as a texture.</p><p>Unity provides the following access macros:</p><table><thead><tr><th><strong>Access macro</strong></th><th><strong>ÊèèËø∞</strong></th></tr></thead><tbody><tr><td><code>UNITY_ACCESS_DOTS_INSTANCED_PROP(PropertyType, PropertyName)</code></td><td>Returns the value loaded from <code>unity_DOTSInstanceData</code> using the layout described above. Shaders that Unity provides use this version for DOTS Instanced built-in properties that don‚Äôt have a default value to fall back on.</td></tr><tr><td><code>UNITY_ACCESS_DOTS_INSTANCED_PROP_WITH_DEFAULT(PropertyType, PropertyName)</code></td><td>Returns the same as <code>UNITY_ACCESS_DOTS_INSTANCED_PROP</code>, except if the most significant bit of the metadata value is zero, it returns a default value. The default value is the value of the regular material property with the same name as the DOTS Instanced property, which is why Shaders that Unity provides use the convention where DOTS Instanced properties have the same name as regular material properties. In this case, the access macro doesn‚Äôt access <code>unity_DOTSInstanceData</code> at all. Shaders that Unity provides use this version for DOTS Instanced material properties, so the loads fall back to the value set on the material.</td></tr><tr><td><code>UNITY_ACCESS_DOTS_INSTANCED_PROP_WITH_CUSTOM_DEFAULT(PropertyType, PropertyName, DefaultValue)</code></td><td>Returns the same as <code>UNITY_ACCESS_DOTS_INSTANCED_PROP</code>, except if the most significant bit of the metadata value is zero, it returns <code>DefaultValue</code> instead, and doesn‚Äôt access <code>unity_DOTSInstanceData</code>.</td></tr><tr><td><code>UNITY_DOTS_INSTANCED_METADATA_NAME(PropertyType, PropertyName)</code></td><td>Returns the metadata value directly without accessing anything. This is useful for custom instance data loading schemes.</td></tr></tbody></table><p>For an example of how to use these macros, see <a href="#access-macro-examples">Access macro example</a>.</p><p>Alongside the access macros, Unity provides shader functions that load the values of built-in constants directly from the draw command data. Shaders that Unity provides use these functions to load the values of the corresponding built-ins.</p><p>Unity provides the following shader functions:</p><table><thead><tr><th><strong>Shader function</strong></th><th><strong>ÊèèËø∞</strong></th></tr></thead><tbody><tr><td><code>LoadDOTSInstancedData_RenderingLayer</code></td><td>Returns the <a href="https://docs.unity3d.com/cn/2022.1/Manual/Rendering.BatchFilterSettings-renderingLayerMask.html" target="_blank" rel="noopener noreferrer">renderingLayerMask</a> for the draw command.</td></tr><tr><td><code>LoadDOTSInstancedData_MotionVectorsParams</code></td><td>Returns the <a href="https://docs.unity3d.com/cn/2022.1/Manual/Rendering.BatchFilterSettings-motionMode.html" target="_blank" rel="noopener noreferrer">motion vector generation mode</a> for the draw command. This is formatted as a float4, which is what Unity shaders expect.</td></tr><tr><td><code>LoadDOTSInstancedData_WorldTransformParams</code></td><td>Returns whether to draw the instance with a flipped triangle winding. See <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchDrawCommandFlags.FlipWinding.html" target="_blank" rel="noopener noreferrer">FlipWinding</a>.</td></tr><tr><td><code>LoadDOTSInstancedData_LightData</code></td><td>Returns whether the scene‚Äôs main light is active for the instance. The main light can be deactivated for multiple reasons, for example if it‚Äôs already included in light maps.</td></tr><tr><td><code>LoadDOTSInstancedData_LODFade</code></td><td>Returns the 8 bit crossfade value you set if the <a href="https://docs.unity3d.com/cn/2022.1/ScriptReference/Rendering.BatchDrawCommandFlags.LODCrossFade.html" target="_blank" rel="noopener noreferrer">LODCrossFade flag</a> is set. If the flag is not set, the return value is undefined.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="access-macro-examples">Access macro examples<a class="hash-link" href="#access-macro-examples" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>This section contains examples of the access macros that Unity provides. There‚Äôs an example of how to use them to access per-instance data and access constant data.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="per-instance">Per-instance<a class="hash-link" href="#per-instance" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h4><p>Âú®Ê≠§Á§∫‰æã‰∏≠Ôºö</p><ul><li>The metadata value for <code>Color</code> is <code>0x80001000</code>.</li><li>The instance index is <code>5</code>.</li><li>Data for instance 0 starts at address 0x1000.</li><li>Data for instance 5 is at address 0x1000 + 5 <!-- -->*<!-- --> sizeof(float4) = 0x1050</li></ul><p>Since the most significant bit is set, the accessor macros don‚Äôt load defaults. This means that <code>c0</code>, <code>c1</code>, and <code>c2</code> will all have the same value, loaded from <code>unity_DOTSInstanceData</code> address <code>0x1050</code>.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">void ExamplePerInstance()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // rawMetadataValue will contain 0x80001000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint rawMetadataValue = UNITY_DOTS_INSTANCED_METADATA_NAME(float4, Color);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float4 c0 = UNITY_ACCESS_DOTS_INSTANCED_PROP(float4, Color);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float4 c1 = UNITY_ACCESS_DOTS_INSTANCED_PROP_WITH_DEFAULT(float4, Color);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float4 c2 = UNITY_ACCESS_DOTS_INSTANCED_PROP_WITH_CUSTOM_DEFAULT(float4, Color, float4(1, 2, 3, 4));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" class="copyButton_wuS7 clean-btn">Â§çÂà∂</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="constant">Constant<a class="hash-link" href="#constant" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h4><p>Âú®Ê≠§Á§∫‰æã‰∏≠Ôºö</p><ul><li>The metadata value for <code>Color</code> is <code>0x00001000</code>.</li><li>The instance index is <code>5</code>.</li><li>Data for instance 0 starts at address 0x1000.</li><li>The most significant bit is not set so data for instance 5 is at the same address as instance 0.</li></ul><p>Since the most significant bit is not set, the accessor macros that fall back to defaults don‚Äôt access <code>unity_DOTSInstanceData</code>. This means that:</p><ul><li><code>c0</code> will contain the value from <code>unity_DOTSInstanceData</code> address <code>0x1000</code>.</li><li><code>c1</code> will contain the value of the regular material property  <strong>Color</strong> , and cause a compile error if the Color property doesn‚Äôt exist.</li><li><code>c2</code> will contain <code>(1, 2, 3, 4)</code> since that was passed as the explicit default value.</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">void ExampleConstant()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // rawMetadataValue will contain 0x00001000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint rawMetadataValue = UNITY_DOTS_INSTANCED_METADATA_NAME(float4, Color);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float4 c0 = UNITY_ACCESS_DOTS_INSTANCED_PROP(float4, Color);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float4 c1 = UNITY_ACCESS_DOTS_INSTANCED_PROP_WITH_DEFAULT(float4, Color);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float4 c2 = UNITY_ACCESS_DOTS_INSTANCED_PROP_WITH_CUSTOM_DEFAULT(float4, Color, float4(1, 2, 3, 4));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" class="copyButton_wuS7 clean-btn">Â§çÂà∂</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="ËØ¶ÁªÜ‰ø°ÊÅØ">ËØ¶ÁªÜ‰ø°ÊÅØ<a class="hash-link" href="#ËØ¶ÁªÜ‰ø°ÊÅØ" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>It is best practice to initialize the first 64 bytes of all <code>unity_DOTSInstanceData</code> buffers to zero and leave them unused. This is because the default metadata value that Unity uses for all metadata values not specified during batch creation is zero. When a shader loads the zero metadata value from the <code>UNITY_ACCESS_DOTS_INSTANCED_PROP</code> macro specifically, it loads the value from the address zero since the instance index will be disregarded. Ensuring that the first 64 bytes, which is the size of the largest value type (a float4x4 matrix), are zeroes guarantees that such loads predictably return a result of zero. Otherwise, the shader could load something unpredictable, depending on what happens to be located at address zero.</p><p>When using DOTS Instancing, Shader Graphs and Shaders that Unity provides use a special convention for transform. To save GPU memory and bandwidth, they store these matrices using only 12 floats instead of the full 16, since four floats are always constant. The format these shaders expect is such that the x, y, and z of each column of the matrix are stored in order. In other words, the first three floats are the x, y, and z of the first column, the next three floats are the x, y, and z of the second column, and so on. They don‚Äôt store the w element of each column. The transform matrices this affects are:</p><ul><li><code>unity_ObjectToWorld</code></li><li><code>unity_WorldToObject</code></li><li><code>unity_MatrixPreviousM</code></li><li><code>unity_MatrixPreviousMI</code></li></ul><p>The following code sample contains a convenient struct that converts regular four-by-four matrices into the 12 floats convention.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">struct PackedMatrix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c0x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c0y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c0z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c1x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c1y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c1z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c2x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c2y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c2z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c3x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c3y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public float c3z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PackedMatrix(Matrix4x4 m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c0x = m.m00;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c0y = m.m10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c0z = m.m20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c1x = m.m01;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c1y = m.m11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c1z = m.m21;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c2x = m.m02;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c2y = m.m12;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c2z = m.m22;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c3x = m.m03;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c3y = m.m13;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c3z = m.m23;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Â§çÂà∂‰ª£Á†ÅÂà∞Ââ™Ë¥¥Êùø" class="copyButton_wuS7 clean-btn">Â§çÂà∂</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/graphics/graphics-performance-profiling/batch-renderer-group/dots-instancing-shaders.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ÁºñËæëÊ≠§È°µ</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ÊñáÊ°£ÂàÜÈ°µÂØºËà™"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/batch-renderer-group/batch-renderer-group-how"><div class="pagination-nav__sublabel">‰∏ä‰∏ÄÈ°µ</div><div class="pagination-nav__label">How BatchRendererGroup works</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/graphics-performance-profiling/frame-debugger"><div class="pagination-nav__sublabel">‰∏ã‰∏ÄÈ°µ</div><div class="pagination-nav__label">The Frame Debugger window</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#supporting-dots-instancing" class="table-of-contents__link toc-highlight">Supporting DOTS Instancing</a></li><li><a href="#declaring-dots-instanced-properties" class="table-of-contents__link toc-highlight">Declaring DOTS Instanced properties</a></li><li><a href="#accessing-dots-instanced-properties" class="table-of-contents__link toc-highlight">Accessing DOTS Instanced properties</a><ul><li><a href="#access-macro-examples" class="table-of-contents__link toc-highlight">Access macro examples</a></li></ul></li><li><a href="#ËØ¶ÁªÜ‰ø°ÊÅØ" class="table-of-contents__link toc-highlight">ËØ¶ÁªÜ‰ø°ÊÅØ</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.13c240a3.js"></script>
<script src="/assets/js/main.8f4a8c68.js"></script>
</body>
</html>